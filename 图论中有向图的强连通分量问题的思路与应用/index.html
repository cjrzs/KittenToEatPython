<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="小猫咪吃python" href="http://yoursite.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="小猫咪吃python" href="http://yoursite.com/atom.xml"><link rel="alternate" type="application/json" title="小猫咪吃python" href="http://yoursite.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/css/app.css?v=0.2.5"><meta name="keywords" content="经典必会,AcWing算法提高课,tarjan,强连通分量问题,scc"><link rel="canonical" href="http://yoursite.com/%E5%9B%BE%E8%AE%BA%E4%B8%AD%E6%9C%89%E5%90%91%E5%9B%BE%E7%9A%84%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%BA%94%E7%94%A8/"><title>有向图的强连通分量问题的思路与应用 - 图论 - 算法 | The Cat to eat Python = 小猫咪吃python = 唤起一天明月 照我满怀冰雪 浩荡百川流 鲸饮未吞海 剑气已横秋</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">有向图的强连通分量问题的思路与应用</h1><div class="meta"><span class="item" title="创建时间：2022-09-18 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-09-18T00:00:00+08:00">2022-09-18</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>14k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>13 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">The Cat to eat Python</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipeun65urj20zk0m81ii.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclgi503lj20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipet4bz0yj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giciundwu5j20zk0m8n9e.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gicitspjpbj20zk0m81ky.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclhnx9glj20zk0m8npd.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="item" rel="index" title="分类于 算法"><span itemprop="name">算法</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/" itemprop="item" rel="index" title="分类于 图论"><span itemprop="name">图论</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://yoursite.com/%E5%9B%BE%E8%AE%BA%E4%B8%AD%E6%9C%89%E5%90%91%E5%9B%BE%E7%9A%84%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%BA%94%E7%94%A8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/avatar.jpg"><meta itemprop="name" content="A Cat Without Sugar"><meta itemprop="description" content="唤起一天明月 照我满怀冰雪 浩荡百川流 鲸饮未吞海 剑气已横秋, 孤独与剑，自由与酒"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="小猫咪吃python"></span><div class="body md" itemprop="articleBody"><h1 id="有向图的强连通分量问题"><a class="anchor" href="#有向图的强连通分量问题">#</a> 有向图的强连通分量问题</h1><blockquote><p>对于一个有向图，它的连通分量：对于分量中 <strong>任意</strong>的两点 u 和 v，都能<strong>从 u 走到 v，并且可以从 v 走到 u</strong>。</p><p>强连通分量（SCC）：<strong>极大连通分量</strong>，对于<strong>分量外的任意一点，加入分量，都会导致 该连通分量不再满足定义</strong>。</p></blockquote><p>强连通分量的<strong>作用</strong>是<strong>将 有向图 通过 缩点 转换为 有向无环图（拓扑图）</strong>。</p><blockquote><p><strong>缩点</strong>：将所有的<strong>连通分量</strong>缩为一个点。</p></blockquote><p><img data-src="/assets/a2a83e17-0f5c-4779-b9aa-b451a6cbc2d5.png" alt=""><br>在上图中，绿色部分就是<strong>强连通分量</strong>，所以我们可以把绿色部分<strong>缩点</strong>为一个点，同时其他四个单独的点，因为<strong>不和其他点相连</strong>，所以也符合<strong>强连通分量</strong>的定义，因此<strong>缩点</strong>后，整个图变成如下<strong>拓扑图</strong>的形式。<br><img data-src="/assets/5bfbaaf7-3f72-4b71-9f9a-6c12a37139a5.png" alt=""></p><h2 id="tarjan算法求强连通分量"><a class="anchor" href="#tarjan算法求强连通分量">#</a> Tarjan 算法求强连通分量</h2><p>（ps: 关于这个部分，个人感觉真的是好难好难，可能也是之前没学过的原因，理解起来特别困难，在网上找了看了很多相关文章，大部分讲的都很好，但是并不适合初学者，希望我写的这个即便是初学者也能看完就懂。）</p><h3 id="时间戳"><a class="anchor" href="#时间戳">#</a> 时间戳</h3><blockquote><p>这个时间戳不是真的表示时间的那个时间戳，它表示的含义是<strong>在图的深度优先搜索遍历过程中，在每个节点第一次遇到的时候，给这个节点一个整数标记</strong>，我们称这些<strong>整数标记</strong>为<strong>时间戳</strong>。<br><img data-src="/assets/18617da1-4dbd-4a38-9394-5d6038aec5e7.png" alt=""></p></blockquote><p>在该算法中，我们需要记录两个时间戳：</p><ol><li><code>dfn[u]</code> ：表示<strong>遍历到 u 时候的时间戳</strong>；</li><li><code>low[u]</code> ：表示<strong>从 u 开始走，所能遍历到的最小的时间戳</strong>；<br><img data-src="/assets/c081ffd7-15dc-4edf-a033-cc6606bce38f.png" alt=""><br>这里，想<strong>用这个图来带大家直观的感受一下 low [u] 数组的含义</strong>：<ol><li>当 <code>u=1</code> 的时候， <code>low[u]</code> 是多少？根据<strong> low [u] 数组的定义</strong>，毫无疑问是他自己，也就是 <code>low[1]=1</code> ；</li><li>当 <code>u=2</code> 的时候， <code>low[u]</code> 是多少？我们观察到图中绿色区域，其实是一个<strong>强连通分量</strong>，所以，根据强连通分量的定义（<strong>强连通分量中任意两点都是可以互相抵达的</strong>），我们知道 <code>2</code> 可以和 <code>1</code> 连通，那么根据 <code>low[u]数组</code> 的定义（<strong>low [2] 所能遍历到的最小时间戳就是 1</strong>），也就是 <code>low[2]=1</code> ;</li><li>同理，因为 <code>4</code> 和 <code>5</code> 都在绿色的<strong>强连通分量</strong>中，所以他们也都能到达 <code>1</code> ，所以有 <code>low[4]=1</code> 和 <code>low[5]=1</code> ；</li><li>而对于 <code>u=3</code> 来说，只有两个点可以到达，一个是他自己，一个是 <code>6</code> ，所以很明显，从 <code>3</code> 开始走，能到达的最小点就是他自己，所以 <code>low[3]=3</code> ;</li><li>而当 <code>u=6</code> ，它就只能到达它自己了，所以 <code>low[6]=6</code> ;</li></ol></li></ol><blockquote><p>通过上面的两个时间戳数组，我们可以得出一个重要性质：<strong>u 是其所在强连通分量的 “最高点”，等价于 dfn [u]==low [u]；</strong></p></blockquote><p>如果能顺利的理解 <code>low[u]</code> 的含义，相信大家就不难理解这句话的含义了。</p><p>如上图中的三个<strong>强连通分量</strong>：{ <code>1，2，4，5</code> }，{ <code>3</code> }，{ <code>6</code> } 中，都是当 <code>dfn[u]</code> 在 “最高点” 或者叫 “最靠前的点” 的时候，<strong>标志着一个 强连通分量 的开始（官方一点叫做 强连通分量子图的最小根）</strong>。</p><p>那么，tarjan 同学是<strong>如何从一个强连通分量的开始，将整个强连通分量都找出来呢？</strong></p><p>其实秘密就在于他使用了<strong>栈</strong>的结构。</p><h3 id="模板code"><a class="anchor" href="#模板code">#</a> 模板 Code</h3><p>首先，要说明的是：tarjan 同学求<strong>强连通分量的算法是基于图的 DFS 遍历的</strong>，所以我们先回顾一下图的 DFS 遍历，假设我们给图中所有的节点都设置一个时间戳，也就是求出 <code>dfn[u]</code> 数组。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    dfs<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span> timestamp<span class="token punctuation">;</span> <span class="token comment">// 给当前节点一个编号</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 遍历当前节点 u 的所有子节点</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token function">dfs</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归搜索所有子节点</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 当前分支搜索到底，也就是程序运行到这里的时候，</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 当前的 u 就是叶子节点，如果没有其他处理，</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 程序会因为所有语句执行完成而隐性的回溯，返回到上一个 dfs (u)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如果读者已经完全的理解上面的<strong>图的 DFS 遍历</strong>，则可以继续看下面 tarjan 同学写的传世经典。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//tarjan 求 scc</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">tarjan</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span> timestamp<span class="token punctuation">;</span> <span class="token comment">// 代码 1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    stk<span class="token punctuation">[</span> <span class="token operator">++</span> top<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">,</span> in_stk<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// 代码 2</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 遍历出 u 的所有子节点 j</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>dfn<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 代码 3</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token function">tarjan</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// DFS 序的遍历</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 代码 4</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>in_stk<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> dfn<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 代码 5</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    </pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">==</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 代码 6</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">int</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token operator">++</span> scc_cnt<span class="token punctuation">;</span> <span class="token comment">// 给 强连通分量 设置一个编号</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 代码 7 开始</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            y <span class="token operator">=</span> stk<span class="token punctuation">[</span>top <span class="token operator">--</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="21"></td><td><pre>            in_stk<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            id<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> scc_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">&#123;</span>y <span class="token operator">!=</span> u<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">// 代码 7 结束</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol><li><p>代码 1：初始化 dfn 和 low 两个数组，这里如果不理解，请回看上面的定义；</p></li><li><p>代码 2： <code>stk[]</code> 数组存储遍历到的节点， <code>in_stk[]</code> 数组记录节点 u 是否在 stk 数组中。所以这句代码的作用就是<strong>初始化</strong>，将<strong>当前节点 u</strong> 放到<strong>栈</strong>结构中，并在另一个<strong>标记数组</strong>中标记该节点 <code>u</code> 目前正在<strong>栈</strong>中。</p></li><li><p>代码 3：假如子节点 <code>j</code> 没有被遍历过 (没被遍历过就是 dfn [j]=0)，则进入递归。</p></li><li><p>代码 4：<strong>更新 low [u] 的第一处代码</strong>，从这句开始，变得烧脑了。这里为啥要用 low [子节点] 去更新 low [父节点] 呢？</p><p>注意这句代码的位置，它是在递归之后的，也就是<strong>搜索完当前分支并回溯的时候，才开始执行的</strong>。</p><p>设想，以上面的 low [u] 数组讲解中的<strong>强连通分量 3 和 6</strong> 为例，当 <code>u=3</code> 的时候 <code>j=6</code> ，并且有 <code>low[3]=3</code> ，这个 <code>low[3]=3</code> 是怎么更新出来的呢？没错，就是这句代码 4 <code>low[u] = min(low[u], low[j]);</code> 更新出来的。</p><p>而从意义来看， <code>low[u]</code> 表示 <code>u</code> 所能到达的点中编号最小的点，而 <code>j</code> 本来就是 <code>u</code> 所能到达的点，所以 <code>low[j]</code> 是完全有可能更新 <code>low[u]</code> 的。</p><p>综上所述，代码 4 存在的原因，我们就找到了，因为 DFS 遍历是必须回溯的，所以可以在<strong>回溯</strong>的时候<strong>通过比较父节点和子节点的 low 数组，来更新父节点的 low 数组</strong>。</p></li><li><p>代码 5：<strong>更新 low [u] 的第二处代码</strong>，我们首先要注意这句代码的进入时机，这句代码是<strong>在子节点已经被拥有编号并且仍然在 stk 中</strong>才会执行，注意子节点已经在 <code>stk</code> 里，说明<strong>这句代码也是需要在回溯阶段执行的</strong>。（至于子节点仍在 stk 中的意义是什么，请往后看。）</p><p>因为 <code>j</code> 是 <code>u</code> 的子节点，也就是说可以从 <code>u</code> 到达 <code>j</code> ，那么根据 <code>low[u]</code> 的定义， <code>dfn[j]</code> 就可能成为 <code>u</code> 能到达的点中编号最小的点，所以要用 <code>dfn[j]</code> 更新 <code>low[u]</code> 是合理的。</p></li><li><p>代码 6：还记得我们的重要性质吗？当触发 <code>代码6</code> 的时候，说明我们找到了一个<strong>强连通分量的开始</strong>，也就是说后面的代码，一定是把整个强连通分量都找出来。</p></li><li><p>代码 7：整个 do...while 循环都在做一件事情，<strong>把整个强连通分量找出来</strong>。</p><p>如果想找出一个范围区间（类比强连通分量），我们需要知道什么？从直觉上来看，我们需要知道区间的起始节点和终止节点，由这两个节点来确定一个区间。事实上的确如此，但是如果我们把区间加入到数据结构<strong>栈</strong>中就变得不需要两个节点了，我们只需要知道一个起始节点就可以了，因为<strong>我们可以从当前起始节点开始出栈，一直到下一个起始节点终止，这样所有出栈的元素，其实就是属于同一个区间</strong>，在这个过程中，我们只需要知道每个区间的起始节点，而不需要知道终止节点。<br><img data-src="/assets/a6c4bd30-7c4c-45d1-b17f-934cf183bfb6.png" alt=""></p><p>明白了这个原理之后，读者再来看代码 7 这段代码片段，是否有种霍然开朗的感觉呢？</p><p>注意，代码 7 的执行时机是<strong>一个分支全部搜索结束的时候</strong>，做的事情实际上就是在<strong>栈顶弹出元素，直到弹出的元素是 起始节点（当前 u），说明我们就找到了以当前 u 为最小根的强连通分量</strong>！</p></li></ol><h2 id="缩点"><a class="anchor" href="#缩点">#</a> 缩点</h2><p>缩点的概念前面已经有描述。此处只要想给出缩点的具体实现。</p><h3 id="模板code-2"><a class="anchor" href="#模板code-2">#</a> 模板 Code</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 遍历所有点</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> u <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> u <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token comment">//j 是 u 的子节点</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment">// 如果 u 和 j 不在一个强连通分量</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">!=</span> id<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   </pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token comment">// 点 u 的出度 ++ </span></pre></td></tr><tr><td data-num="9"></td><td><pre>            dout<span class="token punctuation">[</span>id<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="acwing-1174-受欢迎的牛"><a class="anchor" href="#acwing-1174-受欢迎的牛">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMTE3Ni8=">AcWing 1174. 受欢迎的牛</span></h1><blockquote><p>每一头牛的愿望就是变成一头最受欢迎的牛。</p><p>现在有 N 头牛，编号从 1 到 N，给你 M 对整数 (A,B)，表示牛 A 认为牛 B 受欢迎。</p><p>这种关系是具有传递性的，如果 A 认为 B 受欢迎，B 认为 C 受欢迎，那么牛 A 也认为牛 C 受欢迎。</p><p>你的任务是求出有多少头牛被除自己之外的所有牛认为是受欢迎的。</p><p><strong>输入格式</strong><br>第一行两个数 N,M；</p><p>接下来 M 行，每行两个数 A,B，意思是 A 认为 B 是受欢迎的（给出的信息有可能重复，即有可能出现多个 A,B）。</p><p><strong>输出格式</strong><br>输出被除自己之外的所有牛认为是受欢迎的牛的数量。</p><p><strong>数据范围</strong></p><pre><code>1≤N≤10^4,
1≤M≤5×10^4
</code></pre><p><strong>输入样例</strong></p><pre><code>3 3
1 2
2 1
2 3
</code></pre><p><strong>输出样例</strong></p><pre><code>1
</code></pre><p><strong>样例解释</strong></p><pre><code>只有第三头牛被除自己之外的所有牛认为是受欢迎的。
</code></pre></blockquote><h2 id="题目描述"><a class="anchor" href="#题目描述">#</a> 题目描述</h2><p>给出 N 头牛，编号 1~N，给出 M 个整数对 {A，B}，表示 A 认为 B 是受欢迎的，并且这些整数对表达的关系具有<strong>传递性</strong>，既，如果 A 认为 B 是受欢迎的，B 认为 C 是受欢迎的，那么 A 自动的认为 C 是受欢迎的。</p><p><strong>目标是 求出 有多少头牛 被除自己之外的所有牛 都认为是受欢迎的</strong>。</p><h2 id="题目分析"><a class="anchor" href="#题目分析">#</a> 题目分析</h2><p>根据题目描述，一下就能看出来，这是一个<strong>传递闭包</strong>的题目，但是看一下数据范围：点的范围是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">10^4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span> ，边的范围是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>∗</mo><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">5*10^4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">5</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span>，如果使用<strong> floyd 求传递闭包</strong>是一定会超时的，因此我们需要思考其他方案。</p><p>我们假设，本题是个<strong>有向无环图（拓扑图）</strong>：</p><ol><li>如果拓扑图存在两个点的出度为 0，那么说明不存在牛满足目标。这点很好理解，因为这种情况，至少 出度为 0 的点 不会 被另一个出度为 0 的点 认为受欢迎。</li><li>如果只有一个点出度为 0，那么就表示<strong>其他所有点多能走到这个出度为 0 的点</strong>，也就是其他所有牛都认为它是受欢迎的。</li></ol><p>那么，如何把题目给出的图，变成<strong>拓扑图</strong>呢？这就要用到，我们本文讲的<strong>强连通分量</strong>和<strong>缩点</strong>啦。</p><p>缩点后，拓扑图中所有点都是一个强连通分量，那么出度为 0 的那个强连通分量中的所有点就是目标所求的点。</p><p><strong>因为，出度为 0，说明其他的强连通分量所代表的点都能走到这个点</strong>，这个点也代表一个<strong>强连通分量</strong>，那么根据连通分量定义，<strong>这个强连通分量点中的所有点都互相可达</strong>，所以这个出度为 0 的强连通分量中的所有点都是目标所求的点，统计个数即可。</p><h2 id="code"><a class="anchor" href="#code">#</a> Code</h2><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">10010</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token number">50010</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">int</span> h<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> ne<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> idx<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">int</span> dfn<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> timestamp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">int</span> stk<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> top<span class="token punctuation">,</span> id<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> scc_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">bool</span> in_stk<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> Size<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> dout<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    e<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">,</span> ne<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> h<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> h<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> idx <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">void</span> <span class="token function">tarjan</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span> timestamp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    stk<span class="token punctuation">[</span><span class="token operator">++</span> top<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">,</span> in_stk<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dfn<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token function">tarjan</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>in_stk<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>dfn<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">==</span> dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">int</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token operator">++</span> scc_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            y <span class="token operator">=</span> stk<span class="token punctuation">[</span>top <span class="token operator">--</span> <span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            in_stk<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            id<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> scc_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token comment">// 记录每个强联通分量中点的数量</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            Size<span class="token punctuation">[</span>scc_cnt<span class="token punctuation">]</span> <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>y <span class="token operator">!=</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    cin <span class="token operator">>></span> n <span class="token operator">>></span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>m <span class="token operator">--</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token comment">//tarjan 遍历出所有的强联通份量</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dfn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">tarjan</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token comment">// 缩点</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> u <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> u <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            <span class="token keyword">int</span> a <span class="token operator">=</span> id<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> id<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            <span class="token comment">//a 的出度 +1 </span></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">!=</span> b<span class="token punctuation">)</span> dout<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token keyword">int</span> zeros <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> scc_cnt<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dout<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>            zeros <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            sum <span class="token operator">+=</span> Size<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>zeros <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>                sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="acwing-367-学校网络"><a class="anchor" href="#acwing-367-学校网络">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMzY5Lw==">AcWing 367. 学校网络</span></h1><blockquote><p>一些学校连接在一个计算机网络上，学校之间存在软件支援协议，每个学校都有它应支援的学校名单（学校 A 支援学校 B，并不表示学校 B 一定要支援学校 A）。</p><p>当某校获得一个新软件时，无论是直接获得还是通过网络获得，该校都应立即将这个软件通过网络传送给它应支援的学校。</p><p>因此，一个新软件若想让所有学校都能使用，只需将其提供给一些学校即可。</p><p>现在请问最少需要将一个新软件直接提供给多少个学校，才能使软件能够通过网络被传送到所有学校？</p><p>最少需要添加几条新的支援关系，使得将一个新软件提供给任何一个学校，其他所有学校就都可以通过网络获得该软件？</p><p><strong>输入格式</strong><br>第 1 行包含整数 N，表示学校数量。</p><p>第 2..N+1 行，每行包含一个或多个整数，第 i+1 行表示学校 i 应该支援的学校名单，每行最后都有一个 0 表示名单结束（只有一个 0 即表示该学校没有需要支援的学校）。</p><p><strong>输出格式</strong><br>输出两个问题的结果，每个结果占一行。</p><p><strong>数据范围</strong></p><pre><code>2≤N≤100
</code></pre><p><strong>输入样例</strong></p><pre><code>5
2 4 3 0
4 5 0
0
0
1 0
</code></pre><p><strong>输出样例</strong></p><pre><code>1
2
</code></pre></blockquote><h2 id="题目描述-2"><a class="anchor" href="#题目描述-2">#</a> 题目描述</h2><p>一些学校在一个计算机网络上，一些学校之间有一个软件支援规则，给出 A 支援 B（有向图），最重要的规则是<strong>无论这个学校是直接获得的软件，还是网络中别的学校传给它的，它都需要第一时间传给所有它能传到的学校</strong>，最终的问题有两个：</p><ol><li><strong>最少</strong>需要多少个软件，直接给学校，才能让网络中所有学校都获得；</li><li><strong>最少</strong>需要添加几个新的支援关系，才能让网络中，任意一个学校获得软件，其他所有学校也可以获得。</li></ol><h2 id="题目分析-2"><a class="anchor" href="#题目分析-2">#</a> 题目分析</h2><h3 id="问题1"><a class="anchor" href="#问题1">#</a> 问题 1</h3><p>我们可以通过观察给定示例，来找到这个问题的答案。</p><p><img data-src="/assets/8e2af3a4-bd0c-4157-8a60-c315db18d25d.png" alt=""><br>根据题面中的给定示例，我们可以画出如上图。我们发现想让所有的学校都获得软件，只需要给 <code>1</code> 号点即可，因为<strong> 1 号点可以传给 2,3,4，而 2 号点接到后，又会传给 5 号点，至此，所有的学校都获得了软件</strong>。</p><p>对于上面的图，我们比较容易发现一个规律，在一个<strong>有向无环图</strong>内，图中所有的节点是否都能收到软件，关键在于<strong>节点的起点是否收到软件</strong>，所以，我们<strong>只需要找到给定图的所有 强连通分量，通过 缩点，把给 定图 转换为 有向无环图，然后统计有多少个起点即可。</strong></p><h3 id="问题2"><a class="anchor" href="#问题2">#</a> 问题 2</h3><p>根据问题，我们想让<strong>任何一个点获得软件，那么其他所有点都获得软件</strong>，毫无疑问，这就说明<strong>图中所有的点必须都是两两连通的</strong>，只有这样，才能满足问题条件，也就是说 整个图形成一个<strong>强连通分量</strong>。</p><p>观察示例中的图，我们发现 <code>1,2,5</code> 是一个<strong>强连通分量</strong>，而 <code>1</code> 号点可以到达所有点，所以 <code>2,5</code> 号点也可以到达所有点（根据强连通分量定义），那么<strong>就只有 3 和 4 是无法和其他点连通的，我们把它俩都指向起点（绿色边），这样整个图就全部联通了</strong>。<br><img data-src="/assets/d029bac3-3685-4300-8e22-0c9567b1347d.png" alt=""></p><p>在第一问中，我们已经把整个图变成了一个<strong>有向无环图</strong>，我们假设这个图有 P 个起点（入度为 0），Q 个终点（出度为 0）。</p><p>对于问题：<strong>一个有向无环图，最少加几条边，可以使他变成 强连通分量</strong>，是有一个明确的结论的。</p><blockquote><p>假设一个图是<strong>有向无环图，有 P 个起点，Q 个终点</strong>，那么想让该图变成<strong>强连通分量</strong>，至少要添加 <code>max(P,Q)</code> 条边。</p></blockquote><p>如何论证这个结论呢？我们可以分两步来看，我们假设 <code>P&lt;=Q</code> 时：</p><ol><li><p>当 <code>P==1</code> 的时候，表示只有一个起始点，那么这个起点，由于这个图是有向无环图，所以该起点必然可以走到每个终点，此时，我们<strong>只需要把每一个终点向起点连一条边，就可以使整个图变成强连通分量</strong>。通过下图，我们可以直观的看到，当从每个终点连接一条边（绿色）到起点后，整个图变成了<strong>强连通分量</strong>。<br><img data-src="/assets/28bd7a76-9a8e-47ac-8337-3096445a3ba7.png" alt=""></p></li><li><p>当 <code>P&gt;1</code> 的时候，<strong>必然可以找到两组点满足</strong>：</p><ol><li><strong>某个起点 P1 可以走到某个终点 Q1；</strong></li><li><strong>某个起点 P2 可以走到某个终点 Q2；</strong></li></ol><p><strong>既，不同的起点，可以走到不同的终点</strong>。</p><p>这一点是论证结论的核心，为什么一定会有不同的起点走到不同的终点呢？因为是 <code>有向无环图</code> ，这种图的每个非起点必须有前驱节点，假如好多起点都走到同一个终点 Q1，那么说明 Q2 是孤立的点，与有向无环图定义不符。</p><p>这种情况下，我们把<strong>把某终点的边连接到某起点</strong>，这样子做会<strong>减少一个起点以及一个终点。</strong><br><img data-src="/assets/21cc4a94-2919-4ad6-97e9-bdd79ec1fbc6.png" alt=""></p><p>原来有 <code>P</code> 个起点和 <code>Q</code> 个终点，每连接一条边都会使 <code>P-=1</code> 和 <code>Q-=1</code> ，那么我们只要一共连接 <code>P-1</code> 条边， <code>P</code> 就会变成 <code>1</code> ，此时 <code>Q</code> 会变成 <code>Q-(P-1)</code> ；</p><p>那么根据我们的大前提，<strong>Q 是有可能大于 P</strong> 的。</p><p>此时， <code>P==1</code> , <code>Q&gt;1</code> ，还需要加多少条边呢？这一点我们在上一步 <code>p==1</code> 时候已经求出来了，既，<strong>Q 是多少就需要加多少条边</strong>，那么此时 <code>Q</code> 是 <code>Q-(P-1)</code> ，所以也需要加这么多条边，再算上刚才增加的 <code>P-1</code> 条边，总共增加的边数量就是 <code>Q-(P-1)+(P-1)=Q</code> 。</p></li><li><p>以上原理，是在 <code>P&lt;=Q</code> 的大前提下成立的，那么我们反过来 <code>P&gt;=Q</code> 也是成立的，所以，就有最后的结论： <code>max(Q, P)</code> ；</p></li></ol><h2 id="code-2"><a class="anchor" href="#code-2">#</a> Code</h2><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 边的极限数量，每个点都是孤立的，也就需要 N^2 条边；</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">int</span>  N <span class="token operator">=</span> <span class="token number">110</span><span class="token punctuation">,</span> M <span class="token operator">=</span> N <span class="token operator">*</span> N<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">int</span> h<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> ne<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> idx<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">int</span> dfn<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> timestamp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">int</span> stk<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> top<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">bool</span> in_stk<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">int</span> id<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> scc_cnt<span class="token punctuation">,</span> din<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> dout<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">int</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    e<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">,</span> ne<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> h<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> h<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> idx <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">void</span> <span class="token function">tarjan</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span> timestamp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    stk<span class="token punctuation">[</span><span class="token operator">++</span> top<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">,</span> in_stk<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dfn<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token function">tarjan</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>in_stk<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> dfn<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">==</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token operator">++</span> scc_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">int</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            y <span class="token operator">=</span> stk<span class="token punctuation">[</span>top <span class="token operator">--</span> <span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            id<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> scc_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            in_stk<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>y <span class="token operator">!=</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    cin <span class="token operator">>></span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">int</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token keyword">while</span> <span class="token punctuation">(</span>cin <span class="token operator">>></span> a<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token comment">// 求所有的 强连通分量</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dfn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">tarjan</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token comment">// 缩点</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> u <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> u <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>            <span class="token keyword">int</span> a <span class="token operator">=</span> id<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> id<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            <span class="token comment">//a 向 b 连接  则 a 的出度 ++； b 的入度 ++ ；</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">!=</span> b<span class="token punctuation">)</span> dout<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">++</span> <span class="token punctuation">,</span> din<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token keyword">int</span> P <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> Q <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> scc_cnt<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>din<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> P <span class="token operator">++</span> <span class="token punctuation">;</span> <span class="token comment">// 没有入度 说明是起点</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dout<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> Q <span class="token operator">++</span> <span class="token punctuation">;</span>  <span class="token comment">// 没有出度 说明是终点</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> P<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 问题 1 统计起点</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token comment">// 特判 如果整个图本来就是 一个强连通分量 则不需要加任何的边</span></pre></td></tr><tr><td data-num="68"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>scc_cnt <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token keyword">else</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>P<span class="token punctuation">,</span> Q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 问题 2</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="acwing-1175-最大半连通子图"><a class="anchor" href="#acwing-1175-最大半连通子图">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMTE3Ny8=">AcWing 1175. 最大半连通子图</span></h1><blockquote><p>一个有向图 G=(V,E) 称为半连通的 (Semi-Connected)，如果满足：∀u,v∈V，满足 u→v 或 v→u，即对于图中任意两点 u,v，存在一条 u 到 v 的有向路径或者从 v 到 u 的有向路径。</p><p>若 G′=(V′,E′) 满足，E′ 是 E 中所有和 V′ 有关的边，则称 G′ 是 G 的一个导出子图。</p><p>若 G′ 是 G 的导出子图，且 G′ 半连通，则称 G′ 为 G 的半连通子图。</p><p>若 G′ 是 G 所有半连通子图中包含节点数最多的，则称 G′ 是 G 的最大半连通子图。</p><p>给定一个有向图 G，请求出 G 的最大半连通子图拥有的节点数 K，以及不同的最大半连通子图的数目 C。</p><p>由于 C 可能比较大，仅要求输出 C 对 X 的余数。</p><p><strong>输入格式</strong><br>第一行包含三个整数 N,M,X。N,M 分别表示图 G 的点数与边数，X 的意义如上文所述；</p><p>接下来 M 行，每行两个正整数 a,b，表示一条有向边 (a,b)。</p><p>图中的每个点将编号为 1 到 N，保证输入中同一个 (a,b) 不会出现两次。</p><p><strong>输出格式</strong><br>应包含两行。</p><p>第一行包含一个整数 K，第二行包含整数 C mod X。</p><p><strong>数据范围</strong></p><pre><code>1≤N≤10^5,
1≤M≤10^6,
1≤X≤10^8
</code></pre><p><strong>输入样例</strong></p><pre><code>6 6 20070603
1 2
2 1
1 3
2 4
5 6
6 4
</code></pre><p><strong>输出样例</strong></p><pre><code>3
3
</code></pre></blockquote><h2 id="题目描述-3"><a class="anchor" href="#题目描述-3">#</a> 题目描述</h2><p>本题主要由几个新的概念组成：</p><ol><li><p>有向图半连通：<strong>强连通中，所有点两两之间，存在双向边，既，u 指向 v，v 也必须指向 u；而半连通中，所有点两两之间，存在单向边即可，u 指向 v 或者 v 指向 u 均可</strong>，</p></li><li><p>导出子图：<strong>从原图中选出一些点和一些边，如果选出的边都是与选出点相关的，说明选出的是导出子图</strong>。其中 “相关” 的含义是选出边的两个点，均是选出点。</p></li><li><p>最大半连通子图：如果<strong>导出子图是半连通的，并且该导出子图，是原图所有导出子图中点数最多的</strong>。</p></li></ol><h2 id="题目分析-3"><a class="anchor" href="#题目分析-3">#</a> 题目分析</h2><p>根据题面给定的概念，我们能分析出一个重要的性质：</p><blockquote><p><strong>强连通子图一定是半连通子图，并且一个强连通图内部的最大半连通子图一定是该强连通图本身。</strong></p></blockquote><p>因此，我们可以利用这个性质。老规矩 **，先求出所有强连通子图，然后缩点，将原图变成有向无环图 **。</p><p>在有向无环图中，每个强连通分量中的点一定是符合半连通的，所以我们主要看<strong>两个点不在同一个强连通分量的情况</strong>。</p><p>这种情况下，如果<strong>两个强连通分量相连</strong>，说明这<strong>两个强连通分量必然是有点连接的</strong>，那么这两个强连通分量中的所有点，就可以通过相连接的点连起来，所以这俩<strong>强连通分量中的所有点，也是半连通子图</strong>.</p><p>那么，什么情况下，半连通图会不成立呢？<strong>两个点在有向无环图属于不同的分支</strong>。</p><p><img data-src="/assets/72408583-970e-42e7-b401-e8b3d085f5b0.png" alt=""><br>图中共有 5 个强连通分量，其中 1 号区域是强连通分量，所以 1 号区域中所有点都能走到绿色点；同理，2 号区域所有点都能走到黄色点。又因为绿色点也能走到黄色点，所以 1 号区域所有点可以走到 2 号区域所有点，满足<strong>半连通</strong>。</p><p><img data-src="/assets/469fc996-38a5-4a56-b6ea-336cb6532d47.png" alt=""><br><strong>缩点</strong>成有向无环图后，我们发现形成了两条分支，而属于不同分支的两个区域 <code>3</code> 和 <code>5</code> 是不可达的，不满足半连通。所以这个<strong>有向无环图</strong>中，存在<strong>两个半连通子图</strong>：</p><ol><li>1-&gt;2-&gt;3;</li><li>1-&gt;2-&gt;4-&gt;5;</li></ol><p>因为区域 <code>3,4,5</code> ，都是只有一个点，所以，很明显，第二个半连通子图是最大半连通子图。</p><p>总结一下思路：<strong>先找强连通分量，然后缩点成有向无环图，统计有向无环图中所有起点到终点的路线上，点数量最多的那个</strong>。</p><h2 id="code-3"><a class="anchor" href="#code-3">#</a> Code</h2><p>实现上，最后求点的数量最多的路线，可以使用动态规划的思路：</p><ol><li>f [i] 表示以 f [i] 为结尾的点的最大数量，状态转移就是从 i 的所有前驱节点 j 中取 f [j] 的最大值。</li><li>g [i] 表示以 f [i] 的路线数量。</li></ol><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unordered_set></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">long</span> <span class="token keyword">long</span> LL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">100010</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token number">2000010</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">int</span> h<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> hs<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> ne<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> idx<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">int</span> dfn<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> stk<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> top<span class="token punctuation">,</span> scc_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">bool</span> in_stk<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">int</span> id<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> Size<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Size 表示每个强连通分量中点的数量</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> X<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">int</span> f<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> g<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    e<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">,</span> ne<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> h<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> h<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> idx <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">void</span> <span class="token function">tarjan</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span> timestamp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    stk<span class="token punctuation">[</span><span class="token operator">++</span> top<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">,</span> in_stk<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dfn<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token function">tarjan</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>in_stk<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> dfn<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">==</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token keyword">int</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token operator">++</span> scc_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            y <span class="token operator">=</span> stk<span class="token punctuation">[</span>top <span class="token operator">--</span> <span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            in_stk<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            id<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> scc_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            Size<span class="token punctuation">[</span>scc_cnt<span class="token punctuation">]</span> <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>y <span class="token operator">!=</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span>hs<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> hs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    cin <span class="token operator">>></span> n  <span class="token operator">>></span> m <span class="token operator">>></span> X<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>m <span class="token operator">--</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token function">add</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dfn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">tarjan</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token comment">// 用来判断边是否重复 哈希函数 (v, u) -> v * 1000000 + u</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    unordered_set<span class="token operator">&lt;</span>LL<span class="token operator">></span> S<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> u <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> u <span class="token operator">++</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            <span class="token keyword">int</span> a <span class="token operator">=</span> id<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> id<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            LL hash <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">1000000ll</span> <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token comment">// 乘法可能爆 int 转 LL</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">!=</span> b <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>S<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                S<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                <span class="token function">add</span><span class="token punctuation">(</span>hs<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token comment">// 遍历新图（缩点后的有向无环图） 计算</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> scc_cnt<span class="token punctuation">;</span> u<span class="token punctuation">;</span> u <span class="token operator">--</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        <span class="token comment">// 未被更新过的 f [u] 就是起点 初始化起点</span></pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>f<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>            f<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> Size<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>            g<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>        <span class="token comment">// 遍历 u 能到达的点 j </span></pre></td></tr><tr><td data-num="74"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> hs<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>            <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>            <span class="token comment">// 状态转移 f [j] 等于它的父节点的总点数 f [u]+ 它自己的点数 scc_cnt [j]</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>f<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> f<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> Size<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>                f<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> Size<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>                g<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 从 u 到 j 方案无法增加</span></pre></td></tr><tr><td data-num="80"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> f<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> Size<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>                <span class="token comment">// 当转移方程相等的时候 说明 f [u] + scc_cnt [j] 也是一种最大值方案</span></pre></td></tr><tr><td data-num="82"></td><td><pre>                <span class="token comment">// 所以需要进行累加 g [j] += g [u]</span></pre></td></tr><tr><td data-num="83"></td><td><pre>                g<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>g<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> X<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>    <span class="token keyword">int</span> maxf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> scc_cnt<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>maxf <span class="token operator">&lt;</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>            maxf <span class="token operator">=</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>            sum <span class="token operator">=</span> g<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>maxf <span class="token operator">==</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>            sum <span class="token operator">=</span> <span class="token punctuation">(</span>sum <span class="token operator">+</span> g<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> X<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> maxf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="acwing-368-银河"><a class="anchor" href="#acwing-368-银河">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMzcwLw==">AcWing 368. 银河</span></h1><blockquote><p>银河中的恒星浩如烟海，但是我们只关注那些最亮的恒星。</p><p>我们用一个正整数来表示恒星的亮度，数值越大则恒星就越亮，恒星的亮度最暗是 1。</p><p>现在对于 N 颗我们关注的恒星，有 M 对亮度之间的相对关系已经判明。</p><p>你的任务就是求出这 N 颗恒星的亮度值总和至少有多大。</p><p><strong>输入格式</strong><br>第一行给出两个整数 N 和 M。</p><p>之后 M 行，每行三个整数 T,A,B，表示一对恒星 (A,B) 之间的亮度关系。恒星的编号从 1 开始。</p><p>如果 T=1，说明 A 和 B 亮度相等。<br>如果 T=2，说明 A 的亮度小于 B 的亮度。<br>如果 T=3，说明 A 的亮度不小于 B 的亮度。<br>如果 T=4，说明 A 的亮度大于 B 的亮度。<br>如果 T=5，说明 A 的亮度不大于 B 的亮度。</p><p><strong>输出格式</strong><br>输出一个整数表示结果。</p><p>若无解，则输出 −1。</p><p><strong>数据范围</strong></p><pre><code>N≤100000,M≤100000
</code></pre><p><strong>输入样例</strong></p><pre><code>5 7 
1 1 2 
2 3 2 
4 4 1 
3 4 5 
5 4 5 
2 3 5 
4 5 1 
</code></pre><p><strong>输出样例</strong></p><pre><code>11
</code></pre></blockquote><h2 id="题目描述-4"><a class="anchor" href="#题目描述-4">#</a> 题目描述</h2><p>（天空中最亮的⭐️⭐️~~~）</p><p>给出银河中不同⭐️⭐️之间的亮度关系，问我们所有⭐️⭐️的亮度值总和至少有多大。</p><h2 id="题目分析-4"><a class="anchor" href="#题目分析-4">#</a> 题目分析</h2><p>非常明显的一到<span class="exturl" data-url="aHR0cHM6Ly9janJ6cy5naXRodWIuaW8vJUU1JTlCJUJFJUU4JUFFJUJBJUU0JUI4JUFEJUU1JUI3JUFFJUU1JTg4JTg2JUU3JUJBJUE2JUU2JTlEJTlGJUU5JTk3JUFFJUU5JUEyJTk4JUU3JTlBJTg0JUU1JUI4JUI4JUU4JUE3JTg0JUU2JTgwJTlEJUU4JUI3JUFGLw==">差分约束</span>题目。因此按照差分约束的思路先来分析下，本题求的是最小值，因此需要使用最大路，因此转换为边的符号是 <code>&gt;=</code> ，我们先把题目条件转换成边：</p><ol><li>如果 x=1 ，则 A=B ，那么有 A&gt;=B，B&gt;=A ；</li><li>如果 x=2 ，则 A&lt;B ，那么有 B&gt;=A+1 ；</li><li>如果 x=3 ，则 A&gt;=B ，那么有 A&gt;=B ；</li><li>如果 x=4 ，则 A&gt;B ，那么有 A&gt;=B+1 ；</li><li>如果 x=5 ，则 A&lt;=B ，那么有 B&gt;=A ；</li></ol><p>按照之前的做法就是，先求 spfa 看下是否有正环，有正环则无解，然后 spfa 求最长路。除此之外的关键点是：</p><ol><li>必须找到一个 <code>绝对条件</code> ，只有相对条件是没办法求最值的；</li><li>必须有一个超级源点可以到所有的边；</li></ol><p>在上篇文章中我们使用了栈来优化 spfa，这是因为 spfa 的时间复杂度是 O (km)~O (nm)，会被出题人用数据卡掉，本文我们学了强连通分量后，可以使用强连通分量来解决。</p><p>考虑如果存在正环，那么正环必然是在强连通分量中，而强连通分量中的环，如果合法一定满足三角不等式：如 <code>d[1]&gt;=d[2]&gt;=d[3]&gt;=d[1]</code> ，如何才能让这种三角不等式满足？那就必须是所有的边权重全部是 <code>0</code> （参考当 <code>x=1</code> 的时候），也就是说：<strong>不存在正环，则强连通分量中的每条边必须等于 0</strong>。</p><p><strong>下一步，在有向无环图上求最长路，就比较简单了，只需要从前往后递推一下即可。</strong></p><h2 id="code-4"><a class="anchor" href="#code-4">#</a> Code</h2><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">long</span> <span class="token keyword">long</span> LL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">100010</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token number">600010</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">int</span> h<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> hs<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> w<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> ne<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> idx<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">int</span> dfn<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> stk<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> id<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> Size<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> scc_cnt<span class="token punctuation">,</span> top<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">bool</span> in_stk<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">int</span> dist<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 有向无环图中点之间的最长路径</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    e<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">,</span> w<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">,</span> ne<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> h<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> h<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> idx <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">void</span> <span class="token function">tarjan</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span> timestamp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    stk<span class="token punctuation">[</span> <span class="token operator">++</span> top<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">,</span> in_stk<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dfn<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token function">tarjan</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>in_stk<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> dfn<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">==</span> low<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">int</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token operator">++</span> scc_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            y <span class="token operator">=</span> stk<span class="token punctuation">[</span>top <span class="token operator">--</span> <span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            in_stk<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            id<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> scc_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            Size<span class="token punctuation">[</span>scc_cnt<span class="token punctuation">]</span> <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>y <span class="token operator">!=</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    cin <span class="token operator">>></span> n <span class="token operator">>></span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span>hs<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> hs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token comment">// 建立超级源点 从 0 号点 向其他所有点连接一条长度为 1 的边</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>m <span class="token operator">--</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token keyword">int</span> t<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d%d%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>t<span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token comment">// 因为 0 号点可以到所有其他点，所以从 0 号点做 tarjan 就可以了。</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token function">tarjan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    </pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token keyword">bool</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 判断有没有解</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> u <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> u <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 注意这里的下标 要从点 0 开始</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>            <span class="token keyword">int</span> a <span class="token operator">=</span> id<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> id<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> b <span class="token operator">&amp;&amp;</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token function">add</span><span class="token punctuation">(</span>hs<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            </pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"-1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>        <span class="token comment">//tarjan 之后 倒着遍历 就是拓扑序</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> scc_cnt<span class="token punctuation">;</span> u<span class="token punctuation">;</span> u <span class="token operator">--</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> hs<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>                <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>                dist<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>dist<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> dist<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>        LL res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  i <span class="token operator">&lt;=</span> scc_cnt<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>            <span class="token comment">// 同一个强连通分量中的所有点 到它的后继强连通分量的 最长路径都相等</span></pre></td></tr><tr><td data-num="84"></td><td><pre>            res <span class="token operator">+=</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span>dist<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> Size<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%lld"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>END</strong></p><div class="tags"><a href="/tags/%E7%BB%8F%E5%85%B8%E5%BF%85%E4%BC%9A/" rel="tag"><i class="ic i-tag"></i> 经典必会</a> <a href="/tags/AcWing%E7%AE%97%E6%B3%95%E6%8F%90%E9%AB%98%E8%AF%BE/" rel="tag"><i class="ic i-tag"></i> AcWing算法提高课</a> <a href="/tags/tarjan/" rel="tag"><i class="ic i-tag"></i> tarjan</a> <a href="/tags/%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E9%97%AE%E9%A2%98/" rel="tag"><i class="ic i-tag"></i> 强连通分量问题</a> <a href="/tags/scc/" rel="tag"><i class="ic i-tag"></i> scc</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-09-18 21:37:49" itemprop="dateModified" datetime="2022-09-18T21:37:49+08:00">2022-09-18</time> </span><span id="图论中有向图的强连通分量问题的思路与应用/" class="item leancloud_visitors" data-flag-title="有向图的强连通分量问题的思路与应用" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/wechatpay.png" alt="A Cat Without Sugar 微信支付"><p>微信支付</p></div><div><img data-src="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/alipay.png" alt="A Cat Without Sugar 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>A Cat Without Sugar <i class="ic i-at"><em>@</em></i>小猫咪吃python</li><li class="link"><strong>本文链接：</strong> <a href="http://yoursite.com/%E5%9B%BE%E8%AE%BA%E4%B8%AD%E6%9C%89%E5%90%91%E5%9B%BE%E7%9A%84%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%BA%94%E7%94%A8/" title="有向图的强连通分量问题的思路与应用">http://yoursite.com/图论中有向图的强连通分量问题的思路与应用/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/%E5%9B%BE%E8%AE%BA%E4%B8%AD%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88%E9%97%AE%E9%A2%98%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%BA%94%E7%94%A8/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclflwv2aj20zk0m84qp.jpg" title="最近公共祖先问题的算法思路与应用"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 图论</span><h3>最近公共祖先问题的算法思路与应用</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%89%E5%90%91%E5%9B%BE%E7%9A%84%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E9%97%AE%E9%A2%98"><span class="toc-number">1.</span> <span class="toc-text">有向图的强连通分量问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#tarjan%E7%AE%97%E6%B3%95%E6%B1%82%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F"><span class="toc-number">1.1.</span> <span class="toc-text">Tarjan 算法求强连通分量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3"><span class="toc-number">1.1.1.</span> <span class="toc-text">时间戳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BFcode"><span class="toc-number">1.1.2.</span> <span class="toc-text">模板 Code</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%A9%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">缩点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BFcode-2"><span class="toc-number">1.2.1.</span> <span class="toc-text">模板 Code</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#acwing-1174-%E5%8F%97%E6%AC%A2%E8%BF%8E%E7%9A%84%E7%89%9B"><span class="toc-number">2.</span> <span class="toc-text">AcWing 1174. 受欢迎的牛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90"><span class="toc-number">2.2.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code"><span class="toc-number">2.3.</span> <span class="toc-text">Code</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#acwing-367-%E5%AD%A6%E6%A0%A1%E7%BD%91%E7%BB%9C"><span class="toc-number">3.</span> <span class="toc-text">AcWing 367. 学校网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0-2"><span class="toc-number">3.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-2"><span class="toc-number">3.2.</span> <span class="toc-text">题目分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%981"><span class="toc-number">3.2.1.</span> <span class="toc-text">问题 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%982"><span class="toc-number">3.2.2.</span> <span class="toc-text">问题 2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code-2"><span class="toc-number">3.3.</span> <span class="toc-text">Code</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#acwing-1175-%E6%9C%80%E5%A4%A7%E5%8D%8A%E8%BF%9E%E9%80%9A%E5%AD%90%E5%9B%BE"><span class="toc-number">4.</span> <span class="toc-text">AcWing 1175. 最大半连通子图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0-3"><span class="toc-number">4.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-3"><span class="toc-number">4.2.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code-3"><span class="toc-number">4.3.</span> <span class="toc-text">Code</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#acwing-368-%E9%93%B6%E6%B2%B3"><span class="toc-number">5.</span> <span class="toc-text">AcWing 368. 银河</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0-4"><span class="toc-number">5.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-4"><span class="toc-number">5.2.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code-4"><span class="toc-number">5.3.</span> <span class="toc-text">Code</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/%E5%9B%BE%E8%AE%BA%E5%9F%BA%E7%A1%80%E4%B9%8BDijkstra%E6%B1%82%E6%9C%80%E7%9F%AD%E8%B7%AF/" rel="bookmark" title="图论基础之Dijkstra求最短路">图论基础之Dijkstra求最短路</a></li><li><a href="/%E5%9B%BE%E8%AE%BA%E5%9F%BA%E7%A1%80%E4%B9%8Bbellman-ford%E6%B1%82%E9%99%90%E5%88%B6%E8%BE%B9%E6%95%B0%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF/" rel="bookmark" title="图论基础之bellman-ford求限制边数的最短路">图论基础之bellman-ford求限制边数的最短路</a></li><li><a href="/%E5%9B%BE%E8%AE%BA%E5%9F%BA%E7%A1%80%E4%B9%8Bspfa%E6%B1%82%E6%9C%89%E8%B4%9F%E6%9D%83%E8%BE%B9%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF/" rel="bookmark" title="图论基础之spfa求有负权边的最短路">图论基础之spfa求有负权边的最短路</a></li><li><a href="/%E5%9B%BE%E8%AE%BA%E5%9F%BA%E7%A1%80%E4%B9%8BFloyd%E6%B1%82%E5%A4%9A%E6%BA%90%E6%B1%87%E6%9C%80%E7%9F%AD%E8%B7%AF/" rel="bookmark" title="图论基础之Floyd求多源汇最短路">图论基础之Floyd求多源汇最短路</a></li><li><a href="/%E7%94%A8%E6%81%8B%E7%88%B1%E5%BE%AA%E7%8E%AF%E7%AE%97%E6%B3%95%E6%9D%A5%E8%A7%A3%E5%86%B3%E4%BA%8C%E5%88%86%E5%9B%BE%E7%9A%84%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D%E6%95%B0/" rel="bookmark" title="用恋爱循环算法来解决二分图的最大匹配数">用恋爱循环算法来解决二分图的最大匹配数</a></li><li><a href="/%E5%8D%95%E6%BA%90%E6%9C%80%E7%9F%AD%E8%B7%AF%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E5%BB%BA%E5%9B%BE%E6%96%B9%E5%BC%8F%E5%8F%8A%E6%9C%80%E7%9F%AD%E8%B7%AF%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF%E5%BA%94%E7%94%A8/" rel="bookmark" title="单源最短路中的常用建图方式及最短路算法模板应用">单源最短路中的常用建图方式及最短路算法模板应用</a></li><li><a href="/Floyd%E7%AE%97%E6%B3%95%E6%B1%82%E6%97%A0%E5%90%91%E5%9B%BE%E7%9A%84%E6%9C%80%E5%B0%8F%E7%8E%AF%E9%97%AE%E9%A2%98/" rel="bookmark" title="Floyd算法求无向图的最小环问题">Floyd算法求无向图的最小环问题</a></li><li><a href="/Spfa%E6%B1%82%E8%B4%9F%E7%8E%AF%E7%9A%84%E5%B8%B8%E8%A7%84%E6%80%9D%E8%B7%AF/" rel="bookmark" title="Spfa求负环的常规思路">Spfa求负环的常规思路</a></li><li><a href="/%E5%9B%BE%E8%AE%BA%E4%B8%AD%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F%E9%97%AE%E9%A2%98%E7%9A%84%E5%B8%B8%E8%A7%84%E6%80%9D%E8%B7%AF/" rel="bookmark" title="差分约束问题的常规思路">差分约束问题的常规思路</a></li><li><a href="/%E5%9B%BE%E8%AE%BA%E4%B8%AD%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88%E9%97%AE%E9%A2%98%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%BA%94%E7%94%A8/" rel="bookmark" title="最近公共祖先问题的算法思路与应用">最近公共祖先问题的算法思路与应用</a></li><li class="active"><a href="/%E5%9B%BE%E8%AE%BA%E4%B8%AD%E6%9C%89%E5%90%91%E5%9B%BE%E7%9A%84%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%BA%94%E7%94%A8/" rel="bookmark" title="有向图的强连通分量问题的思路与应用">有向图的强连通分量问题的思路与应用</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="A Cat Without Sugar" data-src="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/avatar.jpg"><p class="name" itemprop="name">A Cat Without Sugar</p><div class="description" itemprop="description">孤独与剑，自由与酒</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">47</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">10</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">61</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E5%9F%BA%E7%A1%80/" title="分类于 基础">基础</a></div><span><a href="/LeetCode%20373.%20%E6%9F%A5%E6%89%BE%E5%92%8C%E6%9C%80%E5%B0%8F%E7%9A%84%20K%20%E5%AF%B9%E6%95%B0%E5%AD%97/" title="LeetCode 373. 查找和最小的K对数字">LeetCode 373. 查找和最小的K对数字</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/" title="分类于 图论">图论</a></div><span><a href="/%E5%8D%95%E6%BA%90%E6%9C%80%E7%9F%AD%E8%B7%AF%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E5%BB%BA%E5%9B%BE%E6%96%B9%E5%BC%8F%E5%8F%8A%E6%9C%80%E7%9F%AD%E8%B7%AF%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF%E5%BA%94%E7%94%A8/" title="单源最短路中的常用建图方式及最短路算法模板应用">单源最短路中的常用建图方式及最短路算法模板应用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" title="分类于 动态规划">动态规划</a></div><span><a href="/AcWing%20291.%20%E8%92%99%E5%BE%B7%E9%87%8C%E5%AE%89%E7%9A%84%E6%A2%A6%E6%83%B3/" title="AcWing 291. 蒙德里安的梦想">AcWing 291. 蒙德里安的梦想</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/" title="分类于 图论">图论</a></div><span><a href="/Floyd%E7%AE%97%E6%B3%95%E6%B1%82%E6%97%A0%E5%90%91%E5%9B%BE%E7%9A%84%E6%9C%80%E5%B0%8F%E7%8E%AF%E9%97%AE%E9%A2%98/" title="Floyd算法求无向图的最小环问题">Floyd算法求无向图的最小环问题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E4%B9%A6%E7%B1%8D%E6%8E%A8%E8%8D%90/" title="分类于 书籍推荐">书籍推荐</a></div><span><a href="/%E6%8E%A8%E8%8D%90%E4%B8%80%E6%9C%AC%E8%B6%A3%E5%91%B3%E7%A7%91%E6%99%AE%E7%B1%BB%E7%9A%84%E4%B9%A6--%E3%80%8A%E5%A4%A7%E5%9B%BD%E9%87%8D%E5%99%A8%E3%80%8B/" title="【随便写写】推荐一本趣味科普类的书--《大国重器》">【随便写写】推荐一本趣味科普类的书--《大国重器》</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E4%B9%A6%E7%B1%8D%E6%8E%A8%E8%8D%90/" title="分类于 书籍推荐">书籍推荐</a></div><span><a href="/%E6%8E%A8%E8%8D%90%E4%B8%80%E6%9C%AC%E4%B9%A6--%E8%AE%A4%E7%9F%A5%E8%A7%89%E9%86%92/" title="推荐一本书《认知觉醒》">推荐一本书《认知觉醒》</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E6%90%9C%E7%B4%A2/" title="分类于 搜索">搜索</a></div><span><a href="/%E7%9C%8B%E5%AE%8C%E5%BF%85%E4%BC%9A%E7%9A%84%E6%90%9C%E7%B4%A2%E4%B9%8B%E8%B6%85%E7%BB%8F%E5%85%B8flood%20fill%E9%97%AE%E9%A2%98%E6%94%BB%E7%95%A5/" title="看完必会的搜索之超经典flood fill问题攻略">看完必会的搜索之超经典flood fill问题攻略</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/python/" title="分类于 python">python</a></div><span><a href="/python%E4%B8%AD%E7%9A%84%E7%94%9F%E6%88%90%E5%99%A8(yield%E4%B8%8Eyield%20from)/" title="python中的生成器(yield与yield from)">python中的生成器(yield与yield from)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="分类于 数据结构">数据结构</a></div><span><a href="/AcWing%20240.%20%E9%A3%9F%E7%89%A9%E9%93%BE%EF%BC%88%E8%B6%85%E6%9C%89%E8%B6%A3%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86%E9%A2%98%E7%9B%AE%EF%BC%89/" title="AcWing 240. 食物链（超有趣的并查集题目）">AcWing 240. 食物链（超有趣的并查集题目）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/" title="分类于 图论">图论</a></div><span><a href="/%E5%9B%BE%E8%AE%BA%E4%B8%AD%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F%E9%97%AE%E9%A2%98%E7%9A%84%E5%B8%B8%E8%A7%84%E6%80%9D%E8%B7%AF/" title="差分约束问题的常规思路">差分约束问题的常规思路</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">A Cat Without Sugar @ The Cat to eat Python</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">264k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">4:01</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"图论中有向图的强连通分量问题的思路与应用/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/js/app.js?v=0.2.5"></script></body></html>