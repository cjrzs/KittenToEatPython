<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="小猫咪吃python" href="http://yoursite.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="小猫咪吃python" href="http://yoursite.com/atom.xml"><link rel="alternate" type="application/json" title="小猫咪吃python" href="http://yoursite.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/css/app.css?v=0.2.5"><meta name="keywords" content="并查集,经典必会,AcWing算法提高课"><link rel="canonical" href="http://yoursite.com/%E5%B9%B6%E6%9F%A5%E9%9B%86%E7%9A%84%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90%E5%92%8C%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/"><title>并查集的实战分析和基础应用 - 数据结构 - 算法 | The Cat to eat Python = 小猫咪吃python = 唤起一天明月 照我满怀冰雪 浩荡百川流 鲸饮未吞海 剑气已横秋</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">并查集的实战分析和基础应用</h1><div class="meta"><span class="item" title="创建时间：2022-10-20 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-10-20T00:00:00+08:00">2022-10-20</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>12k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>11 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">The Cat to eat Python</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicis081o9j20zk0m8dmr.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclxxcb6rj20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giciub8ja1j20zk0m81ky.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicitf0kl1j20zk0m87fe.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipex2cdtbj20zk0m8x6p.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclj9410cj20zk0m8h12.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="item" rel="index" title="分类于 算法"><span itemprop="name">算法</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="item" rel="index" title="分类于 数据结构"><span itemprop="name">数据结构</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://yoursite.com/%E5%B9%B6%E6%9F%A5%E9%9B%86%E7%9A%84%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90%E5%92%8C%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/avatar.jpg"><meta itemprop="name" content="A Cat Without Sugar"><meta itemprop="description" content="唤起一天明月 照我满怀冰雪 浩荡百川流 鲸饮未吞海 剑气已横秋, 孤独与剑，自由与酒"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="小猫咪吃python"></span><div class="body md" itemprop="articleBody"><h1 id="前置知识"><a class="anchor" href="#前置知识">#</a> 前置知识</h1><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9janJ6cy5naXRodWIuaW8vJUU3JTlDJThCJUU1JUFFJThDJUU1JUJGJTg1JUU0JUJDJTlBJUU3JTlBJTg0JUU1JUI5JUI2JUU2JTlGJUE1JUU5JTlCJTg2JUU2JTk0JUJCJUU3JTk1JUE1Lw==">看完必会的并查集入门攻略</span>。本文是上篇文章的延伸，<strong>并查集</strong>的实战应用篇。</p></blockquote><blockquote><p><strong>目录</strong></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9hY3Rpdml0eS9jb250ZW50L3Byb2JsZW0vY29udGVudC8xNTc5Lw==">AcWing 1250. 格子游戏</span>：二维坐标的并查集裸替，主要考察二维坐标转一维。</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9hY3Rpdml0eS9jb250ZW50L3Byb2JsZW0vY29udGVudC8xNTgwLw==">AcWing 1252. 搭配购买</span>：使用并查集把相同集合的多个物品看做一个整体，方便使用 01 背包。</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9hY3Rpdml0eS9jb250ZW50L3Byb2JsZW0vY29udGVudC8xNTgxLw==">AcWing 237. 程序自动分析</span>：带有离散化的并查集。</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQwLw==">AcWing 238. 银河英雄传说</span>：维护额外信息（距离和个数）的并查集。</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQxLw==">AcWing 239. 奇偶游戏</span>：综合应用。带有边权的并查集和带有扩展域的并查集，同时也应用了离散化。</p></blockquote><h1 id="acwing-1250-格子游戏"><a class="anchor" href="#acwing-1250-格子游戏">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9hY3Rpdml0eS9jb250ZW50L3Byb2JsZW0vY29udGVudC8xNTc5Lw==">AcWing 1250. 格子游戏</span></h1><blockquote><p>Alice 和 Bob 玩了一个古老的游戏：首先画一个 n×n 的点阵（下图 n=3）。接着，他们两个轮流在相邻的点之间画上红边和蓝边：<img data-src="https://cdn.acwing.com/media/article/image/2019/12/11/19_9edbcf521b-1.png" alt="1.png"> 直到围成一个封闭的圈（面积不必为 1）为止，“封圈” 的那个人就是赢家。因为棋盘实在是太大了，他们的游戏实在是太长了！他们甚至在游戏中都不知道谁赢得了游戏。于是请你写一个程序，帮助他们计算他们是否结束了游戏？</p><p><strong>输入格式</strong></p><p>输入数据第一行为两个整数 n 和 m。n 表示点阵的大小，m 表示一共画了 m 条线。以后 m 行，每行首先有两个数字 (x,y)，代表了画线的起点坐标，接着用空格隔开一个字符，假如字符是 D，则是向下连一条边，如果是 R 就是向右连一条边。输入数据不会有重复的边且保证正确。</p><p><strong>输出格式</strong></p><p>输出一行：在第几步的时候结束。假如 mm 步之后也没有结束，则输出一行 “draw”。</p><p><strong>数据范围</strong></p><p>1≤n≤200，<br>1≤m≤24000</p><p><strong>输入样例</strong></p><pre><code>3 5
1 1 D
1 1 R
1 2 D
2 1 R
2 2 D
</code></pre><p><strong>输出样例</strong></p><pre><code>4
</code></pre></blockquote><h2 id="题目描述"><a class="anchor" href="#题目描述">#</a> 题目描述</h2><p>在一个 <code>n*n</code> 的点阵上画边，一人画一次，问什么时候可以得到一个封闭的矩形。</p><h2 id="题目分析"><a class="anchor" href="#题目分析">#</a> 题目分析</h2><p>一人一画的规则有点像<strong>博弈论</strong>的问题，但是读到最后，我们发现并没有问，最后赢的人是谁，而是问<strong>什么时候完成封闭矩形的</strong>。</p><p>这样一来就比较简单了。我们可以使用并查集的思路来解决。</p><p><strong>初始的时候，每个点都是单独属于一个集合，把两点连接一条边看做是把两点加入到一个集合里</strong>。这样一来，假如连完边之后，形成了一个矩形，说明<strong>在连边之前，这两个点一定已经在一个集合中</strong>。</p><p>因此，本题其实只需要在合并之前，判断一下两个点是否在同一个集合，就可以知道连完之后会不会出现封闭矩阵。</p><h2 id="code"><a class="anchor" href="#code">#</a> Code</h2><p>实现的时候，需要注意的一点是：题目给出的点是二维的，我们需要转换成一维。</p><p>二维转一维的公式是： <code>x坐标 * n + y坐标</code> (其中 x 和 y 必须从 0 开始)。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">40010</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token number">24010</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">int</span> p<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> res<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">// 二维点坐标变成一维</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">return</span> x <span class="token operator">*</span> n <span class="token operator">+</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    cin <span class="token operator">>></span> n <span class="token operator">>></span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n <span class="token operator">*</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> m<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">char</span> t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        cin <span class="token operator">>></span> x <span class="token operator">>></span> y <span class="token operator">>></span> t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token comment">// 二维转一维 坐标必须从 0 开始 不然不满足公式</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        x <span class="token operator">--</span> <span class="token punctuation">,</span> y <span class="token operator">--</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">int</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token char">'D'</span><span class="token punctuation">)</span> b <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token keyword">else</span> b <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">int</span> pa <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> pb <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token comment">// 两个点在同一集合 则连边后形成封闭矩阵</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>pa <span class="token operator">==</span> pb<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            res <span class="token operator">=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        p<span class="token punctuation">[</span>pa<span class="token punctuation">]</span> <span class="token operator">=</span> pb<span class="token punctuation">;</span> <span class="token comment">// 不在同一集合 合并两条边</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">)</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"draw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">else</span> cout <span class="token operator">&lt;&lt;</span> res <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="acwing-1252-搭配购买"><a class="anchor" href="#acwing-1252-搭配购买">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9hY3Rpdml0eS9jb250ZW50L3Byb2JsZW0vY29udGVudC8xNTgwLw==">AcWing 1252. 搭配购买</span></h1><blockquote><p>Joe 觉得云朵很美，决定去山上的商店买一些云朵。商店里有 n 朵云，云朵被编号为 1,2,…,n 并且每朵云都有一个价值。但是商店老板跟他说，一些云朵要搭配来买才好，所以买一朵云则与这朵云有搭配的云都要买。但是 Joe 的钱有限，所以他希望买的价值越多越好。</p><p><strong>输入格式</strong></p><p>第 1 行包含三个整数 n，m，w 表示有 n 朵云，m 个搭配，Joe 有 w 的钱。第 2∼n+1 行，每行两个整数 ci，di 表示 i 朵云的价钱和价值。第 n+2∼n+1+m 行，每行两个整数 ui，vi 表示买 ui 就必须买 vi，同理，如果买 vi 就必须买 ui。</p><p><strong>输出格式</strong></p><p>一行，表示可以获得的最大价值。</p><p><strong>数据范围</strong></p><p>1≤n≤10000,<br>0≤m≤5000,<br>1≤w≤10000,<br>1≤ci≤5000,<br>1≤di≤100,<br>1≤ui,vi≤n</p><p><strong>输入样例</strong></p><pre><code>5 3 10
3 10
3 10
3 10
5 100
10 1
1 3
3 2
4 2
</code></pre><p><strong>输出样例</strong></p><pre><code>1
</code></pre></blockquote><h2 id="题目描述-2"><a class="anchor" href="#题目描述-2">#</a> 题目描述</h2><p>（买云朵的故事真是太浪漫啦～～）</p><p>一些云朵需要搭配起来购买，总共有 n 朵云，m 个搭配，Joe 同学有 w 块钱，每个云朵都有价钱和价值两种属性，问怎么买才能获得最大价值的云朵。</p><h2 id="题目分析-2"><a class="anchor" href="#题目分析-2">#</a> 题目分析</h2><p>一眼看上去非常的像有 <code>依赖的背包问题</code> ，但是我们仔细的读题，会发现与依赖背包还是不太一样，对于本题来说，如果<strong>有一个云朵被买，那么所有与该云朵搭配的云朵都需要一起被买</strong>（而依赖背包中是只有父节点被购买，才需要子节点也购买，反过来，子节点购买，是不需要购买父节点的），这就启发我们，<strong>把所有搭配的云朵看做一个集合（并查集的集），然后把每个集合作为一个商品</strong>，这样本题就变成了<strong> 01 背包</strong>问题。</p><h2 id="code-2"><a class="anchor" href="#code-2">#</a> Code</h2><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">10010</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">int</span> p<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> w<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> v<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> money<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    cin <span class="token operator">>></span> n <span class="token operator">>></span> m <span class="token operator">>></span> money<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> cin <span class="token operator">>></span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    </pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>m <span class="token operator">--</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        cin <span class="token operator">>></span> a <span class="token operator">>></span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">int</span> pa <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">int</span> pb <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token comment">// 合并一个集合里的云朵 价格和价值 别忘记合并</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>pa <span class="token operator">!=</span> pb<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            w<span class="token punctuation">[</span>pa<span class="token punctuation">]</span> <span class="token operator">+=</span> w<span class="token punctuation">[</span>pb<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            v<span class="token punctuation">[</span>pa<span class="token punctuation">]</span> <span class="token operator">+=</span> v<span class="token punctuation">[</span>pb<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            p<span class="token punctuation">[</span>pb<span class="token punctuation">]</span> <span class="token operator">=</span> pa<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token comment">// 01 背包模板</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> money<span class="token punctuation">;</span> j <span class="token operator">>=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> j <span class="token operator">--</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                f<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>j <span class="token operator">-</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> f<span class="token punctuation">[</span>money<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="acwing-237-程序自动分析"><a class="anchor" href="#acwing-237-程序自动分析">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9hY3Rpdml0eS9jb250ZW50L3Byb2JsZW0vY29udGVudC8xNTgxLw==">AcWing 237. 程序自动分析</span></h1><blockquote><p>在实现程序自动分析的过程中，常常需要判定一些约束条件是否能被同时满足。</p><p>考虑一个约束满足问题的简化版本：假设 x1,x2,x3,… 代表程序中出现的变量，给定 n 个形如 xi=xj 或 xi≠xj 的变量相等 / 不等的约束条件，请判定是否可以分别为每一个变量赋予恰当的值，使得上述所有约束条件同时被满足。</p><p>例如，一个问题中的约束条件为：x1=x2，x2=x3，x3=x4，x1≠x4，这些约束条件显然是不可能同时被满足的，因此这个问题应判定为不可被满足。</p><p>现在给出一些约束满足问题，请分别对它们进行判定。</p><p><strong>输入格式</strong><br>输入文件的第 1 行包含 1 个正整数 t，表示需要判定的问题个数，注意这些问题之间是相互独立的。</p><p>对于每个问题，包含若干行：</p><p>第 1 行包含 1 个正整数 n，表示该问题中需要被满足的约束条件个数。</p><p>接下来 n 行，每行包括 3 个整数 i,j,e，描述 1 个相等 / 不等的约束条件，相邻整数之间用单个空格隔开。若 e=1，则该约束条件为 xi=xj；若 e=0，则该约束条件为 xi≠xj。</p><p><strong>输出格式</strong><br>输出文件包括 t 行。</p><p>输出文件的第 k 行输出一个字符串 YES 或者 NO，YES 表示输入中的第 k 个问题判定为可以被满足，NO 表示不可被满足。</p><p><strong>数据范围</strong><br>1≤n≤10^5<br>1≤i,j≤10^9</p><p><strong>输入样例</strong></p><pre><code class="language-2">2
1 2 1
1 2 0
2
1 2 1
2 1 1
</code></pre><p><strong>输出样例</strong></p><pre><code>NO
YES
</code></pre></blockquote><h2 id="题目分析-3"><a class="anchor" href="#题目分析-3">#</a> 题目分析</h2><p>给出一些约束条件，这些约束条件分为两个种类，一种是等于，一种是不等于，问题是<strong>给出的约束条件能否同时满足</strong>。</p><h2 id="题目分析-4"><a class="anchor" href="#题目分析-4">#</a> 题目分析</h2><p>本题第一眼看上去，有些像<span class="exturl" data-url="aHR0cHM6Ly9janJ6cy5naXRodWIuaW8vJUU1JTlCJUJFJUU4JUFFJUJBJUU0JUI4JUFEJUU1JUI3JUFFJUU1JTg4JTg2JUU3JUJBJUE2JUU2JTlEJTlGJUU5JTk3JUFFJUU5JUEyJTk4JUU3JTlBJTg0JUU1JUI4JUI4JUU4JUE3JTg0JUU2JTgwJTlEJUU4JUI3JUFGLw==">差分约束问题</span>，但是我们发现本题的约束条件只有两种，一种等于，一种不等于，所以我们完全没必要把约束条件转换成图。</p><p>我们发现这两种类型的数据具有明显的<strong>传递关系</strong>，那就可以把这两种关系类型的数据用<strong>集合</strong>维护起来，<strong>等于号的在一个集合，不等于号的在另一个集合</strong>，这样只要<strong>集合出现冲突</strong>就说明这个问题可以被判定为不满足条件。</p><p>而维护具有传递关系的集合，我们就可以使用<strong>并查集</strong>。</p><p>例如题面给出的示例： <code>x1=x2，x2=x3，x3=x4，x1≠x4</code> ，我们<strong>先把所有相等关系的数据合并到一个集合中</strong>，那么<strong>在所有的不等关系的数据中，只要两个数据在同一个集合内，就说明发生冲突</strong>，比如 <code>x1</code> 和 <code>x4</code> 。</p><h2 id="code-3"><a class="anchor" href="#code-3">#</a> Code</h2><p>本题虽然看起来是一个并查集的裸题，但是其实难点并不在并查集，而是隐藏在<strong>数据范围</strong>中。</p><p>本题的约束条件数量 n 总共有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">10^6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span> 个，每个约束条件有两个数据，也就是说数据最多也就只会有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>∗</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">2*10^6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span> 个，可是单个数据的最大值却达到了<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding="application/x-tex">10^9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span></span></span></span>，那么对于并查集数组来说，就需要<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding="application/x-tex">10^9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span></span></span></span> 的空间大小，这显然是不可行的。所以，我们需要使用<strong>离散化</strong>把的单个数据的大小映射到最大为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">10^6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span>。</p><blockquote><p>离散化的作用：当出现数据范围很大，但是能用到的很小的时候，可以<strong>使用 离散化 把 数据范围 压缩到 使用范围</strong>。</p><p>比如，本题把单个数据最大<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding="application/x-tex">10^9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span></span></span></span> 压缩到单个数据最大<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">10^6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span>。</p></blockquote><p>离散化一般分为两种：<strong>保持数据顺序的离散化</strong>和<strong>不保序的离散化</strong>。</p><p><strong>保序的离散化</strong>一般要分为三个步骤：排序、判重、二分。</p><p><strong>不保序的离散化</strong>比较简单可以使用 <code>map</code> 或者 <code>hash表</code> 之类的数据结构实现即可。</p><p>（离散化不是本文重点，因此不做过多讲述，代码中有注释。）</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unordered_map></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">2000010</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">int</span> p<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> S<span class="token punctuation">;</span> <span class="token comment">// 离散化 hash 表</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Query</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span>query<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">// 超级简单的不保序离散化</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// 将单个数据范围在 1~10^9 压缩到 单个数据范围在 1~10^6</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// 如果 x 不在哈希表中 就给它一个映射值。</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> S<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">return</span> S<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 返回 x 在哈希表的位置</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">return</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">int</span> T<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    cin <span class="token operator">>></span> T<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>T <span class="token operator">--</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        cin <span class="token operator">>></span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        S<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d%d%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            query<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token function">get</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token comment">// 合并 所有的 相等约束条件</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>e <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token keyword">int</span> pa <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                <span class="token keyword">int</span> pb <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                p<span class="token punctuation">[</span>pa<span class="token punctuation">]</span> <span class="token operator">=</span> pb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token comment">// 检查不等条件</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token keyword">bool</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>e <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                <span class="token keyword">int</span> pa <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                <span class="token keyword">int</span> pb <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                <span class="token comment">// 在同一个集合说明相等 与 不等条件冲突</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span>pa <span class="token operator">==</span> pb<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="58"></td><td><pre>                    flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                    <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"NO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token keyword">else</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"YES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="acwing-238-银河英雄传说"><a class="anchor" href="#acwing-238-银河英雄传说">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQwLw==">AcWing 238. 银河英雄传说</span></h1><blockquote><p>有一个划分为 N 列的星际战场，各列依次编号为 1,2,…,N。有 N 艘战舰，也依次编号为 1,2,…,N，其中第 i 号战舰处于第 i 列。有 T 条指令，每条指令格式为以下两种之一：</p><ol><li><code>M i j</code> ，表示让第 i 号战舰所在列的全部战舰保持原有顺序，接在第 j 号战舰所在列的尾部。</li><li><code>C i j</code> ，表示询问第 i 号战舰与第 j 号战舰当前是否处于同一列中，如果在同一列中，它们之间间隔了多少艘战舰。</li></ol><p>现在需要你编写一个程序，处理一系列的指令。</p><p><strong>输入格式</strong></p><p>第一行包含整数 T，表示共有 T 条指令。接下来 T 行，每行一个指令，指令有两种形式： <code>M i j</code> 或 <code>C i j</code> 。其中 M 和 C 为大写字母表示指令类型，i 和 j 为整数，表示指令涉及的战舰编号。</p><p><strong>输出格式</strong></p><p>你的程序应当依次对输入的每一条指令进行分析和处理：如果是 <code>M i j</code> 形式，则表示舰队排列发生了变化，你的程序要注意到这一点，但是不要输出任何信息；如果是 <code>C i j</code> 形式，你的程序要输出一行，仅包含一个整数，表示在同一列上，第 i 号战舰与第 j 号战舰之间布置的战舰数目，如果第 i 号战舰与第 j 号战舰当前不在同一列上，则输出−1。</p><p><strong>数据范围</strong></p><p>N≤30000,T≤500000</p><p><strong>输入样例</strong></p><pre><code>4
M 2 3
C 1 2
M 2 4
C 4 2
</code></pre><p><strong>输出样例</strong></p><pre><code>-1
1
</code></pre></blockquote><h2 id="题目描述-3"><a class="anchor" href="#题目描述-3">#</a> 题目描述</h2><p>并查集的模型，加了一个题面，有 N 个集合，初始化时候，每个集合有一个元素。给出两种命令，一种是合并，一种是查询，不过这个合并的规则是<strong>必须是 a 和并到 b 上，也就 a 的父节点是 b</strong>。而查询的也不仅仅是两个数是否在一个集合，而是<strong>当两个数据在一个集合的时候输出这两个数据的 之间有多少个数据</strong>。</p><p>本题题面隐性表达了非常重要的一点，那就是本题的所有集合均是<strong>链</strong>，因为<strong>所有的合并都是合并到集合的末尾</strong>。（后面的分析如果不明白就可以思考一下，<strong>集合是链</strong>的含义。）</p><h2 id="题目分析-5"><a class="anchor" href="#题目分析-5">#</a> 题目分析</h2><p>比较裸的一个并查集题目。主要的难点在于<strong>如何维护并查集中数据的位置</strong>。</p><p>在<span class="exturl" data-url="aHR0cHM6Ly9janJ6cy5naXRodWIuaW8vJUU3JTlDJThCJUU1JUFFJThDJUU1JUJGJTg1JUU0JUJDJTlBJUU3JTlBJTg0JUU1JUI5JUI2JUU2JTlGJUE1JUU5JTlCJTg2JUU2JTk0JUJCJUU3JTk1JUE1Lw==">基础篇</span>中，我们已经讲解过，使用<strong> size 数组维护集合中元素的数量</strong>。而本题还需要配合一个另外的数组 <code>d</code> ，来<strong>维护并查集中元素到它的根节点的距离</strong>。</p><blockquote><p>d [x]：表示集合中的元素 x 到它的根节点 p [x] 的距离。</p></blockquote><p>维护这个距离的意义是什么呢？</p><p>试想一下，我们想<strong>求的是一个集合中 a 和 b 之间的距离</strong>，那么我们只要知道<strong>它俩分别到根节点的距离，用这两个距离做差</strong>就求出来了。</p><p>比如，<strong>x 和 y 在一个集合，x 到根节点的距离 <code>d[x]=4</code> ，而 y 到根节点的距离 <code>d[y]=7</code> ，那么很明显它俩之间的数据就是 <code>d[x]-d[y]</code> 的绝对值减一，也就是它俩之间有两个元素（5 和 6）</strong>。</p><p>那么，现在的问题就变成了<strong>如何维护距离数组 d</strong> 呢？</p><p>首先考虑，两个集合的合并，假设我们把<strong>集合 x 合并到了集合 y</strong> 上面。</p><p><img data-src="/assets/ca72916e-741c-47cb-8817-9f5e24ba1b48.png" alt=""></p><p>通过图中，我们能直观的看到<strong>合并的情况</strong>，当集合 px 合并到 py，那么<strong> p [x] 到根节点的距离 就是 合并前 py 中 的所有数据</strong>，而合并后，集合 px 就消失了，只剩下集合 py，<strong>py 中的数据数量就是 两个集合的数量之和</strong>。</p><p>除此之外，在合并的时候，在上面的合并上，我们其实并没有求出每个点到根节点的距离，那么我们就可以在，<strong>路径优化</strong>的时候，来维护每个节点到根节点的距离。</p><p>在<strong>路径优化</strong>维护距离的时候，我们虽然不知道每个距离到根节点的距离，但是我们可以用<strong>自底向上的递归</strong>，从根节点出发来更新每个节点的距离。</p><p><img data-src="/assets/772cc222-be48-43fe-a93b-dfbeb11347fc.png" alt=""></p><p>综上，我们就维护出了一个每个元素到根节点的距离的数组 d。</p><h2 id="code-4"><a class="anchor" href="#code-4">#</a> Code</h2><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">300010</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> p<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> sz<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 维护距离的并查集模板</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">int</span> root <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先递归到根节点</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        d<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> d<span class="token punctuation">[</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 根节点开始累加</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">return</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    cin <span class="token operator">>></span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// 初始化 每个节点到自身的距离为 0 </span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">// 初始化 每个集合中的数据个数为 1 也就是根节点自己</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> N<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">,</span> d<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> sz<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>m <span class="token operator">--</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">char</span> t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        cin <span class="token operator">>></span> t <span class="token operator">>></span> a <span class="token operator">>></span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">int</span> pa <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> pb <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token char">'M'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token comment">// 当两个数据不在一个集合 则合并</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>pa <span class="token operator">!=</span> pb<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token comment">// 合并 且维护信息</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                p<span class="token punctuation">[</span>pa<span class="token punctuation">]</span> <span class="token operator">=</span> pb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                d<span class="token punctuation">[</span>pa<span class="token punctuation">]</span> <span class="token operator">=</span> sz<span class="token punctuation">[</span>pb<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                sz<span class="token punctuation">[</span>pb<span class="token punctuation">]</span> <span class="token operator">+=</span> sz<span class="token punctuation">[</span>pa<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>pa <span class="token operator">!=</span> pb<span class="token punctuation">)</span> cout <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                <span class="token comment">// 注意输出的时候 因为减一的关系 可能会负</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                <span class="token comment">// 但是有解情况 最小是 0 也就是自己到自己</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                cout <span class="token operator">&lt;&lt;</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">-</span> d<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="acwing-239-奇偶游戏"><a class="anchor" href="#acwing-239-奇偶游戏">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQxLw==">AcWing 239. 奇偶游戏</span></h1><blockquote><p>小 A 和小 B 在玩一个游戏。首先，小 A 写了一个由 0 和 1 组成的序列 S，长度为 N。然后，小 B 向小 A 提出了 M 个问题。在每个问题中，小 B 指定两个数 l 和 r，小 A 回答 S [l∼r] 中有奇数个 1 还是偶数个 1。机智的小 B 发现小 A 有可能在撒谎。例如，小 A 曾经回答过 S [1∼3] 中有奇数个 1，S [4∼6] 中有偶数个 1，现在又回答 S [1∼6] 中有偶数个 1，显然这是自相矛盾的。请你帮助小 B 检查这 M 个答案，并指出在至少多少个回答之后可以确定小 A 一定在撒谎。即求出一个最小的 k，使得 01 序列 S 满足第 1∼k 个回答，但不满足第 1∼k+1 个回答。</p><p><strong>输入格式</strong></p><p>第一行包含一个整数 N，表示 01 序列长度。第二行包含一个整数 M，表示问题数量。接下来 M 行，每行包含一组问答：两个整数 l 和 r，以及回答 <code>even</code> 或 <code>odd</code> ，用以描述 S [l∼r] 中有偶数个 1 还是奇数个 1。</p><p><strong>输出格式</strong></p><p>输出一个整数 k，表示 01 序列满足第 1∼k 个回答，但不满足第 1∼k+1 个回答，如果 01 序列满足所有回答，则输出问题总数量。</p><p><strong>数据范围</strong></p><p>N≤109,M≤5000</p><p><strong>输入样例</strong></p><pre><code>10
5
1 2 even
3 4 odd
5 6 even
1 6 even
7 10 odd
</code></pre><p><strong>输出样例</strong></p><pre><code>3
</code></pre></blockquote><h2 id="题目描述-4"><a class="anchor" href="#题目描述-4">#</a> 题目描述</h2><p>一个有趣的游戏，小 A 给出一个 01 序列 S，小 B 问小 A 一个区间 [l,r] 内有多少个 1。但是小 B 发现小 A 可能会说谎，比如小 A 说区间 [1,3] 中有奇数个 1，[4,6] 有偶数个 1，那么<strong>奇数 加上 偶数 则一定有 奇数个 1</strong>，也就是区间 [1,6] 一定有奇数个 1，可是小 A 又说 [1,6] 有偶数个 1，所以小 A 说谎了。</p><p>问题是<strong>给出 M 个回答，问小 B 在第几个回答的时候发现小 A 说慌了</strong>。</p><h2 id="题目分析-6"><a class="anchor" href="#题目分析-6">#</a> 题目分析</h2><p>本题给出的是一个<strong>区间</strong>的奇偶性，对于整个区间而言是不太好分析的，所以使用类似<span class="exturl" data-url="aHR0cHM6Ly9janJ6cy5naXRodWIuaW8vJUU1JUFFJTlFJUU3JTk0JUE4JUU3JTlBJTg0JUU3JUFFJTk3JUU2JUIzJTk1JUU1JUIwJThGJUU2JThBJTgwJUU1JUI3JUE3LS0lRTUlODklOEQlRTclQkMlODAlRTUlOTIlOEMv">前缀和</span>的思想，将<strong>区间转换为变量</strong>。</p><p>使用 sum [i] 表示 <code>1~i</code> 中 1 的个数的奇偶数组。则有：</p><ol><li><p>S [L,R] 有偶数个 1，等价于 sum [L-1] 与 sum [R] 的奇偶性相同。例如，示例中有 S [1,3] 有奇数个 1，S [4,6] 有偶数个 1。而区间 S [4,6] 又可以拆分成 sum [3] 和 sum [6]，并且他们两个奇偶性应该相同，而 sum [3] 就是区间 S [1,3] 是奇数，所以 sum [6] 就是区间 S [1,6] 也应该是奇数。</p></li><li><p>S [L,R] 有奇数个 1，等价于 sum [L-1] 与 sum [R] 的奇偶性不同。与上面同理。</p></li></ol><p>注意在上面的思路中，我们并没有求出整个 sum 数组，只是把 sum [3] 和 sum [6] 看做一个变量。</p><p>如此，我们就构造出了<strong>数据的传递关系</strong>，因此，我们就可以参考上题的思路，使用并查集来解决。</p><p>但是与上题相比，本题有三种关系：</p><ol><li><p>如果 x1 和 x2 的奇偶性相同，x2 和 x3 奇偶性也相同，那么 x1 和 x3 奇偶性相同；</p></li><li><p>如果 x1 和 x3 的奇偶性相同，x2 和 x3 奇偶性不同，那么 x1 和 x3 奇偶性不同；</p></li><li><p>如果 x1 和 x2 的奇偶性不同，x2 和 x3 奇偶性也不同，那么 x1 和 x3 的奇偶性相同；</p></li></ol><p>我们神奇的发现，如果把<strong>奇偶性相同看做 1，不同看做 0</strong>，那么这不就是<strong>异或</strong>的运算规则嘛？</p><p>对于这种<strong>多种传递关系的并查集</strong>，一种解决方案是使用<strong>带边权的并查集</strong>，还有一种解决方案是使用<strong>带扩展域的并查集</strong>。</p><h3 id="带边权的并查集"><a class="anchor" href="#带边权的并查集">#</a> 带边权的并查集</h3><p>我们可以参考一下上一道题，在上一道题中，同样是判断矛盾，当发现不等式组的两个数据在<strong>同一个集合</strong>中，我们就认为是矛盾。但是在本题中，我们还需要知道<strong>这两个数据在这个集合中的奇偶关系是否什么样的</strong>。</p><p>那么如何<strong>维护一个集合中不同数据的关系呢</strong>？</p><p>我们可以让集合中的每个数据都与根节点产生关联，以此间接的使所有的数据关联到一起。</p><p>比如：a 与根节点奇偶性不同，b 与根节点奇偶性相同，则我们可以知道 a 与 b 奇偶性不同。</p><p>所以，在<strong>路径优化</strong>的过程中，就可以<strong>把每个数据与根节点的关系维护出来</strong>，也就是<strong>带有边权的并查集</strong>。</p><blockquote><p>带有边权的并查集，使用一个数组 <code>d[x]</code> 维护数据 <code>x</code> 与根节点 <code>p[x]</code> 的<strong>相对</strong>关系。</p><p>在本题中，边权 d [x] 为 0 表示与根节点 p [x] 的奇偶性相同，为 1 表示与根节点 p [x] 的奇偶性不同。</p></blockquote><p>综上，我们总结一下本题的思路：</p><ol><li><p>对于给定的每个区间，我们判断 sum [L] 和 sum [R] 是否属于一个集合（奇偶性关系已知）。</p></li><li><p>属于一个集合的话，判断他们在集合内的奇偶关系与给出的奇偶关系是否相同，如果不相同，说明出现矛盾，小 A 说谎了。</p></li><li><p>如果不属于一个集合，则将两个数据合并。</p></li></ol><h3 id="带扩展域的并查集"><a class="anchor" href="#带扩展域的并查集">#</a> 带扩展域的并查集</h3><p>我们把变量 X 拆分成两个节点，一个是 Xodd，一个是 Xeven。其中 Xodd 表示 sum [X] 是奇数，Xeven 表示 sum [X] 是偶数，我们一般也会把这两个节点分别称为<strong>奇数域</strong>和<strong>偶数域</strong>。</p><p>在带扩展域的并查集中，我们要合并的就是这些域，而非数据本身。</p><p>假设，题目给出区间 [L,R] 的奇偶性是 ans，并且 sum [L-1] 和 sum [R] 离散化之后是 x 和 y，假设，我们让 ans 为 0 表示偶数，1 表示奇数。</p><p>那么当 ans 等于 0 的时候，合并 <code>Xodd,Yodd</code> ，合并 <code>Xeven,Yeven</code> ，表示当 X 和 Y 的奇偶性相同的时候，可以互相推出，既知道 X 是偶数，则 Y 也是偶数；知道 X 是奇数，则 Y 也是奇数。</p><p>当 ans 等于 1 的时候，合并 <code>Xodd,Yeven</code> ，合并 <code>Xeven,Yodd</code> ，表示当 X 和 Y 奇偶性不同的时候，可以互相推出。</p><p>我们的想一下，<strong>这样做有什么好处呢</strong>？</p><p>我们把使用<strong>并查集 维护数据 变成了 维护条件</strong>，也就是我们本来维护的是 X 和 Y，现在变成了维护 X 是偶数，Y 是奇数等<strong>条件</strong>。</p><p>这样做，当我们知道 X 与 Y 的关系之后，如果又知道了 Y 与 Z 的关系，那么我们也就知道了 X 与 Z 的关系，也就是这些条件具有<strong>传递性</strong>。</p><p>比如，通过数据 <code>x,y,0</code> 推出 X 和 Y 的奇偶性相同，再来一个数据 <code>y,z,1</code> 推出 Y 和 Z 奇偶性不同，我们就可以得到 <code>x,z,1</code> 表示 X 与 Z 的奇偶性也是不同的。</p><p>那么，<strong>我们如何判断矛盾呢</strong>？</p><p>假如<strong>两个变量 X 和 Y，有 Xodd 和 Yodd 在一个集合，说明两者奇偶性必定相同；如果 Xodd 和 Yeven 在一个集合里说明两者奇偶性是不同的</strong>，那么如果新数据与之相悖，说明出现了矛盾。</p><h2 id="code-5"><a class="anchor" href="#code-5">#</a> Code</h2><p>在实现上，由于本题的数据范围也是比较奇怪，N 的长度为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding="application/x-tex">10^9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span></span></span></span>，但是问答 M 的数量只有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span>，因此也需要使用离散化压缩数据。</p><h3 id="带边权的并查集-2"><a class="anchor" href="#带边权的并查集-2">#</a> 带边权的并查集</h3><p>带边权的并查集，在合并时候要更新边权数组 d []。</p><p>我们定义 d [x] 表示的是 x 到根节点 p [x] 的关系，d [y] 是 y 到根节点 p [y] 的关系，那么合并的时候，假如是把 x 合并到了 y 上面（以 y 作为集合根节点），那么 x 到根节点的关系就由三部分组成：</p><ol><li><p>x 到 x 的原根节点 p [x]，这部分就是 d [x]；</p></li><li><p>x 的原根节点 p [x] 到 y，也就是 <code>d[p[x]]</code> 我们是不知道的，但是我们知道合并后的结果，假设合并后的结果是 t，那么就有 <code>t=d[x]^d[y]^d[p[x]]</code> ，如此，我们就推出了 <code>d[p[x]]=d[x]^d[y]^t</code> ；</p></li><li><p>y 到根节点 p [y]，这部分就是 d [y]；</p></li></ol><p><img data-src="/assets/e635ebce-0183-4080-bbfb-52af19c1104b.png" alt=""></p><p>我们把这三部分全部异或起来，就得到了合并后的 d [x]。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unordered_map></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">20010</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">int</span> p<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> S<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// 带权并查集的路径压缩 必须注意细节</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">// 一定 先计算边权 再压缩</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">int</span> root <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        d<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">^=</span> d<span class="token punctuation">[</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> S<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">return</span> S<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    cin <span class="token operator">>></span> n <span class="token operator">>></span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">int</span> res <span class="token operator">=</span> m<span class="token punctuation">;</span> <span class="token comment">// 没有矛盾输出问题的数量</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        string c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        cin <span class="token operator">>></span> a <span class="token operator">>></span> b <span class="token operator">>></span> c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token comment">// 获取离散化后的 sum [L-1] 和 sum [R]</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        a <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>a <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 表示偶数个 1</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token string">"odd"</span><span class="token punctuation">)</span> t <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 1 表示有奇数个 1</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">int</span> pa <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> pb <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token comment">// 如果两个数据的奇偶关系已知</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>pa <span class="token operator">==</span> pb<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token comment">// 判断他们的奇偶关系 是否和本次数据相同</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">^</span> d<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                res <span class="token operator">=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>            p<span class="token punctuation">[</span>pa<span class="token punctuation">]</span> <span class="token operator">=</span> pb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            <span class="token comment">// 并查集到根</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            d<span class="token punctuation">[</span>pa<span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">^</span> d<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">^</span> t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> res <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="带扩展域的并查集-2"><a class="anchor" href="#带扩展域的并查集-2">#</a> 带扩展域的并查集</h3><p>在实现上，我们如何表示两个点呢？</p><p>可以直接用两个不同的数，假如数据为 X，那么我们可以让 X 本身来表示 Xeven，用 <code>X+Base</code> 来表示 Xodd（这里的 Base 为数据总量除以 2，所以 X+Base 是一个一定不在本题使用范围内的数，因此保证了数据不会重复）。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unordered_map></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">20010</span><span class="token punctuation">,</span> Base <span class="token operator">=</span> N <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">int</span> p<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> S<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">return</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> S<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">return</span> S<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    cin <span class="token operator">>></span> n <span class="token operator">>></span> m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">int</span> res <span class="token operator">=</span> m<span class="token punctuation">;</span> <span class="token comment">// 没有矛盾输出问题的数量</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        string c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        cin <span class="token operator">>></span> a <span class="token operator">>></span> b <span class="token operator">>></span> c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token comment">// 获取离散化后的 sum [L-1] 和 sum [R]</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        a <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>a <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 表示偶数个 1</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token comment">// 假如给出数据是 X 和 Y 是偶数关系</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token comment">// 则有 Xodd 和 Yodd 在一个集合 Xeven 和 Yeven 在一个集合</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token string">"even"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token comment">// 如果 Xodd 和 Yeven 在一个集合 一定矛盾</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">find</span><span class="token punctuation">(</span>a <span class="token operator">+</span> Base<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">find</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                res <span class="token operator">=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            p<span class="token punctuation">[</span><span class="token function">find</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token function">find</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Xodd 和 Yodd 合并到一个集合</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            p<span class="token punctuation">[</span><span class="token function">find</span><span class="token punctuation">(</span>a <span class="token operator">+</span> Base<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token function">find</span><span class="token punctuation">(</span>b <span class="token operator">+</span> Base<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Xeven 和 Yeven 合并到一个集合</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token comment">// 反之，则相反</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">find</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">find</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                res <span class="token operator">=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>            p<span class="token punctuation">[</span><span class="token function">find</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token function">find</span><span class="token punctuation">(</span>b <span class="token operator">+</span> Base<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Xeven 和 Yodd 在一个集合</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            p<span class="token punctuation">[</span><span class="token function">find</span><span class="token punctuation">(</span>a <span class="token operator">+</span> Base<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token function">find</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Xodd 和 Yeven 在一个集合</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> res <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>END</strong></p><div class="tags"><a href="/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/" rel="tag"><i class="ic i-tag"></i> 并查集</a> <a href="/tags/%E7%BB%8F%E5%85%B8%E5%BF%85%E4%BC%9A/" rel="tag"><i class="ic i-tag"></i> 经典必会</a> <a href="/tags/AcWing%E7%AE%97%E6%B3%95%E6%8F%90%E9%AB%98%E8%AF%BE/" rel="tag"><i class="ic i-tag"></i> AcWing算法提高课</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-10-20 23:24:03" itemprop="dateModified" datetime="2022-10-20T23:24:03+08:00">2022-10-20</time> </span><span id="并查集的实战分析和基础应用/" class="item leancloud_visitors" data-flag-title="并查集的实战分析和基础应用" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/wechatpay.png" alt="A Cat Without Sugar 微信支付"><p>微信支付</p></div><div><img data-src="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/alipay.png" alt="A Cat Without Sugar 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>A Cat Without Sugar <i class="ic i-at"><em>@</em></i>小猫咪吃python</li><li class="link"><strong>本文链接：</strong> <a href="http://yoursite.com/%E5%B9%B6%E6%9F%A5%E9%9B%86%E7%9A%84%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90%E5%92%8C%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/" title="并查集的实战分析和基础应用">http://yoursite.com/并查集的实战分析和基础应用/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/%E7%9C%8B%E5%AE%8C%E5%BF%85%E4%BC%9A%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86%E6%94%BB%E7%95%A5/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeu7txpzj20zk0m81kx.jpg" title="看完必会的并查集入门攻略"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 数据结构</span><h3>看完必会的并查集入门攻略</h3></a></div><div class="item right"><a href="/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%80%9D%E8%B7%AF%E5%92%8C%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giciundwu5j20zk0m8n9e.jpg" title="树状数组的基本思路和简单实现"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 数据结构</span><h3>树状数组的基本思路和简单实现</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#acwing-1250-%E6%A0%BC%E5%AD%90%E6%B8%B8%E6%88%8F"><span class="toc-number">2.</span> <span class="toc-text">AcWing 1250. 格子游戏</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90"><span class="toc-number">2.2.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code"><span class="toc-number">2.3.</span> <span class="toc-text">Code</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#acwing-1252-%E6%90%AD%E9%85%8D%E8%B4%AD%E4%B9%B0"><span class="toc-number">3.</span> <span class="toc-text">AcWing 1252. 搭配购买</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0-2"><span class="toc-number">3.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-2"><span class="toc-number">3.2.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code-2"><span class="toc-number">3.3.</span> <span class="toc-text">Code</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#acwing-237-%E7%A8%8B%E5%BA%8F%E8%87%AA%E5%8A%A8%E5%88%86%E6%9E%90"><span class="toc-number">4.</span> <span class="toc-text">AcWing 237. 程序自动分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-3"><span class="toc-number">4.1.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-4"><span class="toc-number">4.2.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code-3"><span class="toc-number">4.3.</span> <span class="toc-text">Code</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#acwing-238-%E9%93%B6%E6%B2%B3%E8%8B%B1%E9%9B%84%E4%BC%A0%E8%AF%B4"><span class="toc-number">5.</span> <span class="toc-text">AcWing 238. 银河英雄传说</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0-3"><span class="toc-number">5.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-5"><span class="toc-number">5.2.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code-4"><span class="toc-number">5.3.</span> <span class="toc-text">Code</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#acwing-239-%E5%A5%87%E5%81%B6%E6%B8%B8%E6%88%8F"><span class="toc-number">6.</span> <span class="toc-text">AcWing 239. 奇偶游戏</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0-4"><span class="toc-number">6.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-6"><span class="toc-number">6.2.</span> <span class="toc-text">题目分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E8%BE%B9%E6%9D%83%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="toc-number">6.2.1.</span> <span class="toc-text">带边权的并查集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E6%89%A9%E5%B1%95%E5%9F%9F%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="toc-number">6.2.2.</span> <span class="toc-text">带扩展域的并查集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code-5"><span class="toc-number">6.3.</span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E8%BE%B9%E6%9D%83%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86-2"><span class="toc-number">6.3.1.</span> <span class="toc-text">带边权的并查集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E6%89%A9%E5%B1%95%E5%9F%9F%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86-2"><span class="toc-number">6.3.2.</span> <span class="toc-text">带扩展域的并查集</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/%E7%9C%8B%E5%AE%8C%E5%BF%85%E4%BC%9A%E7%9A%84%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E5%85%A5%E9%97%A8%E6%94%BB%E7%95%A5/" rel="bookmark" title="看完必会的滑动窗口入门攻略">看完必会的滑动窗口入门攻略</a></li><li><a href="/AcWing%20240.%20%E9%A3%9F%E7%89%A9%E9%93%BE%EF%BC%88%E8%B6%85%E6%9C%89%E8%B6%A3%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86%E9%A2%98%E7%9B%AE%EF%BC%89/" rel="bookmark" title="AcWing 240. 食物链（超有趣的并查集题目）">AcWing 240. 食物链（超有趣的并查集题目）</a></li><li><a href="/%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BA%8C%E5%8F%89%E5%A0%86%E7%9A%84%E5%AE%9E%E7%8E%B0/" rel="bookmark" title="有趣的数据结构-二叉堆的实现">有趣的数据结构-二叉堆的实现</a></li><li><a href="/%E7%9C%8B%E5%AE%8C%E5%BF%85%E4%BC%9A%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86%E6%94%BB%E7%95%A5/" rel="bookmark" title="看完必会的并查集入门攻略">看完必会的并查集入门攻略</a></li><li class="active"><a href="/%E5%B9%B6%E6%9F%A5%E9%9B%86%E7%9A%84%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90%E5%92%8C%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/" rel="bookmark" title="并查集的实战分析和基础应用">并查集的实战分析和基础应用</a></li><li><a href="/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%80%9D%E8%B7%AF%E5%92%8C%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/" rel="bookmark" title="树状数组的基本思路和简单实现">树状数组的基本思路和简单实现</a></li><li><a href="/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E7%9A%84%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8/" rel="bookmark" title="树状数组的实战应用">树状数组的实战应用</a></li><li><a href="/%E7%9C%8B%E5%AE%8C%E5%BF%85%E4%BC%9A%E7%9A%84%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%94%BB%E7%95%A52.0%EF%BC%88%E4%B8%8A%EF%BC%89/" rel="bookmark" title="看完必会的线段树攻略2.0（上）">看完必会的线段树攻略2.0（上）</a></li><li><a href="/%E7%9C%8B%E5%AE%8C%E5%BF%85%E4%BC%9A%E7%9A%84%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%94%BB%E7%95%A52.0%EF%BC%88%E4%B8%8B%EF%BC%89/" rel="bookmark" title="看完必会的线段树攻略2.0（下）">看完必会的线段树攻略2.0（下）</a></li><li><a href="/%E3%80%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%91%E7%9C%8B%E5%AE%8C%E5%BF%85%E4%BC%9A%E7%9A%84%E5%AD%97%E5%85%B8%E6%A0%91%E6%94%BB%E7%95%A5/" rel="bookmark" title="看完必会的字典树攻略">看完必会的字典树攻略</a></li><li><a href="/%E3%80%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%91%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/" rel="bookmark" title="可持久化数据结构的基础应用">可持久化数据结构的基础应用</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="A Cat Without Sugar" data-src="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/images/avatar.jpg"><p class="name" itemprop="name">A Cat Without Sugar</p><div class="description" itemprop="description">孤独与剑，自由与酒</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">64</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">10</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">78</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/%E7%9C%8B%E5%AE%8C%E5%BF%85%E4%BC%9A%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86%E6%94%BB%E7%95%A5/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%80%9D%E8%B7%AF%E5%92%8C%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E5%AD%A6/" title="分类于 数学">数学</a></div><span><a href="/%E4%BB%8E%E4%BB%A3%E7%A0%81%E7%9A%84%E8%A7%92%E5%BA%A6%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86--%E8%B4%A8%E6%95%B0/" title="从代码的角度重新认识--质数">从代码的角度重新认识--质数</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="分类于 数据结构">数据结构</a></div><span><a href="/%E7%9C%8B%E5%AE%8C%E5%BF%85%E4%BC%9A%E7%9A%84%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%94%BB%E7%95%A52.0%EF%BC%88%E4%B8%8A%EF%BC%89/" title="看完必会的线段树攻略2.0（上）">看完必会的线段树攻略2.0（上）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" title="分类于 动态规划">动态规划</a></div><span><a href="/AcWing%20898.%20%E6%95%B0%E5%AD%97%E4%B8%89%E8%A7%92%E5%BD%A2/" title="AcWing 898. 数字三角形">AcWing 898. 数字三角形</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E6%90%9C%E7%B4%A2/" title="分类于 搜索">搜索</a></div><span><a href="/%E7%BB%8F%E8%BF%8720211202%E8%BF%99%E4%B8%AA%E7%89%B9%E6%AE%8A%E7%9A%84%E5%9B%9E%E6%96%87%E6%97%A5%EF%BC%8C%E6%88%91%E9%A1%BF%E6%82%9F%E4%BA%86%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E4%B8%B2%E9%97%AE%E9%A2%98%E7%9A%84%E7%BB%88%E6%9E%81%E8%A7%A3%E6%B3%95/" title="经过20211202这个特殊的回文日，我顿悟了最长回文串问题的终极解法">经过20211202这个特殊的回文日，我顿悟了最长回文串问题的终极解法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/" title="分类于 图论">图论</a></div><span><a href="/%E4%BA%8C%E5%88%86%E5%9B%BE%E4%B8%AD%E7%9A%84%E6%9C%80%E5%B0%8F%E8%B7%AF%E5%BE%84%E7%82%B9%E8%A6%86%E7%9B%96%E9%97%AE%E9%A2%98%E7%9A%84%E6%B1%82%E8%A7%A3%E6%80%9D%E8%B7%AF/" title="图论基础之二分图中的最小路径点覆盖问题的求解思路">图论基础之二分图中的最小路径点覆盖问题的求解思路</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="分类于 数据结构">数据结构</a></div><span><a href="/%E7%9C%8B%E5%AE%8C%E5%BF%85%E4%BC%9A%E7%9A%84%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E5%85%A5%E9%97%A8%E6%94%BB%E7%95%A5/" title="看完必会的滑动窗口入门攻略">看完必会的滑动窗口入门攻略</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E5%9F%BA%E7%A1%80/" title="分类于 基础">基础</a></div><span><a href="/LeetCode%20373.%20%E6%9F%A5%E6%89%BE%E5%92%8C%E6%9C%80%E5%B0%8F%E7%9A%84%20K%20%E5%AF%B9%E6%95%B0%E5%AD%97/" title="LeetCode 373. 查找和最小的K对数字">LeetCode 373. 查找和最小的K对数字</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" title="分类于 动态规划">动态规划</a></div><span><a href="/%E7%9C%8B%E5%AE%8C%E5%BF%85%E4%BC%9A%E7%9A%84%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97%E4%BC%98%E5%8C%96DP%E6%94%BB%E7%95%A5/" title="看完必会的单调队列优化DP攻略">看完必会的单调队列优化DP攻略</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/" title="分类于 图论">图论</a></div><span><a href="/%E7%94%A8%E6%81%8B%E7%88%B1%E5%BE%AA%E7%8E%AF%E7%AE%97%E6%B3%95%E6%9D%A5%E8%A7%A3%E5%86%B3%E4%BA%8C%E5%88%86%E5%9B%BE%E7%9A%84%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D%E6%95%B0/" title="用恋爱循环算法来解决二分图的最大匹配数">用恋爱循环算法来解决二分图的最大匹配数</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/" title="分类于 图论">图论</a></div><span><a href="/%E6%97%A0%E5%90%91%E5%9B%BE%E7%9A%84%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E7%9A%84%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%BA%94%E7%94%A8/" title="无向图的双连通分量的思路与应用">无向图的双连通分量的思路与应用</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">A Cat Without Sugar @ The Cat to eat Python</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">358k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">5:26</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"并查集的实战分析和基础应用/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="//cdn.jsdelivr.net/gh/cjrzs/KittenToEatPython@latest/js/app.js?v=0.2.5"></script></body></html>